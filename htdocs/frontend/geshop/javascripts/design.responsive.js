!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define("designResponsive",t):t()}(0,function(){"use strict";var e,t,a,k={gTarget:"",pTarget:"",lDrag:"layout-drag",lDrop:"layout-drop",cDrag:"component-drag",cDrop:"component-drop",loadingIndex:"",documentObject:window.document,site_code:(e="site_group_code",a=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),(t=document.cookie.match(a))?t[2]:null)};k.get=function(e){return this[e]},k.set=function(e,t){this[e]=t},k.toClassName=function(e){return"."+this[e]},k.freeDragTarget=function(){this.set("gTarget","")},k.freeDropTarget=function(){this.set("pTarget","")},k.freeAllTargets=function(){this.freeDragTarget(),this.freeDropTarget()},k.enableLoading=function(e){$("#design_view_loading").css({backgroundColor:e||"rgba(0, 0, 0, .3)"}).show()},k.disableLoading=function(){$("#design_view_loading").hide()},k.componentFormShow=function(){$("#component_form_dialog").show()},k.componentFormHide=function(){$("#component_form_dialog",k.documentObject).hide(),$("#component_form_dialog").hide()},k.removeTip=function(){$("#component_layout_add_position_tips",k.documentObject).remove()},k.addBackGroundColor=function(){$(".geshop-drop-tip-center-right").css({backgroundColor:"rgba(30,159,255,0.2)"})},k.removeBackGroundColor=function(){$(".geshop-drop-tip-center-right").css({backgroundColor:"#ffffff"})},k.layoutTitleOpacity=function(){$(".design-preview-layout-title",k.documentObject).css({opacity:1})},k.enableLayuiLoading=function(){this.loadingIndex=layui.layer.load(1,{shade:[.2,"#000000"]})},k.disableLayuiLoading=function(){layui.layer.close(this.loadingIndex)},k.postAjax=function(e,t,a,i){if("function"!=typeof a)return!1;this.enableLoading(),$.ajax({type:"POST",url:e,data:t,success:a,error:i,dataType:"json"})},k.removeDragTarget=function(){this.get("gTarget").parentNode.removeChild(this.get("gTarget"))},k.dropInParent=function(e){var t,a,i,n;if(0<$(this.get("gTarget")).closest(".design-view").length){if("layout"===e){t="/activity/zf/layout-design/move-layout",a={page_id:$("#pageId").val(),id:$(this.get("gTarget")).attr("id"),lang:$("#pageLang").val()};var o=$("#component_layout_add_position_tips",k.documentObject).prevAll(".geshop-layout-box").attr("id");if(a.prev_id=void 0===o?0:o,a.id===a.prev_id)return!1}else if("component"===e){t="/activity/zf/ui-design/move-ui",a={page_id:$("#pageId").val(),id:$(this.get("gTarget")).data("id"),layout_id:$(this.get("pTarget")).closest(this.toClassName("lDrag")).attr("id"),position:$(this.get("pTarget")).closest("[data-position]").data("position"),lang:$("#pageLang").val()};var s=$("#component_layout_add_position_tips",k.documentObject).prevAll(".geshop-component-box").attr("data-id");a.prev_id=void 0===s?0:s}i=function(e){k.disableLoading(),0===e.code?(k.removeDragTarget(),0<$("#component_layout_add_position_tips").length?$(k.get("gTarget")).insertBefore($("#component_layout_add_position_tips")):$(k.get("pTarget")).append(k.get("gTarget"))):layui.layer.msg(e.message),k.removeTip(),k.renderLayoutTitle()}}else if("layout"===e){if(t="/activity/zf/layout-design/add-layout",a={page_id:$("#pageId").val(),component_key:$(this.get("gTarget")).data("key"),lang:$("#pageLang").val()},i=function(e){k.disableLoading(),0===e.code?("0"===sessionStorage.layout_position||"1"===sessionStorage.layout_position?$("#component_layout_add_position_tips",k.documentObject).before(e.data.component_html):$(k.get("pTarget")).append(e.data.component_html),k.renderViewPage()):layui.layer.msg(e.message),k.removeTip(),k.renderLayoutTitle()},o=$("#component_layout_add_position_tips",k.documentObject).prevAll(".geshop-layout-box").attr("id"),a.prev_id=void 0===o?0:o,1===Number($(this.get("gTarget")).data("custom")))return k.openCustomLayoutDialog($(this.get("pTarget")),a.prev_id,!0),!1}else if("component"===e){var r=Boolean($(this.get("gTarget")).data("unique")),l=$("#design_view [data-key="+$(this.get("gTarget")).data("key")+"][data-unique=true]").length;if(r&&0<l)return layui.layer.msg("此组件只能创建一次！"),k.removeTip(),!1;var d=$(this.get("pTarget")).closest(this.toClassName("lDrag")).find('[data-unique="true"][data-key="U000055"], [data-unique="true"][data-key="U000056"]').length;if(!r&&0<d)return layui.layer.msg("请将组件放置到其他布局！"),k.removeTip(),!1;var c=$(this.get("gTarget")).data("key"),p=$(this.get("pTarget")).closest(this.toClassName("lDrag")).find(".geshop-component-box").length;if(r&&-1!=$.inArray(c,["U000055","U000056"])&&0<p)return layui.layer.msg("当前布局已有组件，不能够再放置，请将组件放置到空布局！"),k.removeTip(),!1;t="/activity/zf/ui-design/add-ui",a={page_id:$("#pageId").val(),layout_id:$(this.get("pTarget")).closest(this.toClassName("lDrag")).attr("id"),component_key:$(this.get("gTarget")).data("key"),position:$(this.get("pTarget")).parent().data("position"),lang:$("#pageLang").val()};var u=$(this.get("gTarget")).data("tplid");u&&(a.ui_tpl_id=u),i=function(e){if(k.disableLoading(),0===e.code){var t=e.data.async_data_info?e.data.async_data_info:[];window.GESHOP_ASYNC_DATA_INFO=Object.assign({},window.GESHOP_ASYNC_DATA_INFO),window.GESHOP_ASYNC_DATA_INFO[e.data.ui_id]=t,window.postMessage&&window.postMessage({data:window.GESHOP_ASYNC_DATA_INFO,message_type:"dresslily_update_goods_info"},window.location.origin),"0"===sessionStorage.position||"1"===sessionStorage.position?$("#component_layout_add_position_tips",k.documentObject).before(e.data.component_html):$(k.get("pTarget")).append(e.data.component_html),k.renderViewPage()}else layui.layer.msg(e.message);k.removeTip(),k.renderLayoutTitle()},s=$("#component_layout_add_position_tips",k.documentObject).prevAll(".geshop-component-box").attr("data-id"),a.prev_id=void 0===s?0:s}n=function(e){k.disableLoading(),k.disableLayuiLoading(),layui.layer.msg(e.message)},this.postAjax(t,a,i,n)},k.dropInChild=function(e){var t,a,i,n;if(0<$(this.get("gTarget")).closest(".design-view").length){if("layout"===e){t="/activity/zf/layout-design/move-layout",a={page_id:$("#pageId").val(),id:$(this.get("gTarget")).attr("id"),lang:$("#pageLang").val()};var o=$("#component_layout_add_position_tips",k.documentObject).prevAll(".geshop-layout-box").attr("id");a.prev_id=void 0===o?0:o}else if("component"===e){t="/activity/zf/ui-design/move-ui",a={page_id:$("#pageId").val(),id:$(this.get("gTarget")).data("id"),layout_id:$(this.get("pTarget")).closest(this.toClassName("lDrag")).attr("id"),position:$(this.get("pTarget")).closest("[data-position]").data("position"),lang:$("#pageLang").val()};var s=$("#component_layout_add_position_tips",k.documentObject).prevAll(".geshop-component-box").attr("data-id");a.prev_id=void 0===s?0:s}if(a&&(a.id===a.next_id||a.id===a.prev_id))return!1;i=function(e){k.disableLoading(),0===e.code?(k.removeDragTarget(),$(k.get("gTarget")).insertBefore($("#component_layout_add_position_tips"))):layui.layer.msg(e.message),k.removeTip(),k.renderLayoutTitle()}}else if("layout"===e){if(t="/activity/zf/layout-design/add-layout",a={page_id:$("#pageId").val(),component_key:$(this.get("gTarget")).data("key"),lang:$("#pageLang").val()},i=function(e){k.disableLoading(),0===e.code?("0"===sessionStorage.layout_position?$(k.get("pTarget")).before(e.data.component_html):"1"===sessionStorage.layout_position&&$(k.get("pTarget")).after(e.data.component_html),k.renderViewPage()):layui.layer.msg(e.message),k.removeTip(),k.renderLayoutTitle()},o=$("#component_layout_add_position_tips",k.documentObject).prev(".geshop-layout-box").attr("id"),a.prev_id=void 0===o?0:o,1===Number($(this.get("gTarget")).data("custom")))return k.openCustomLayoutDialog($(this.get("pTarget")),a.prev_id,!1),!1}else if("component"===e){var r=Boolean($(this.get("gTarget")).data("unique")),l=$("#design_view [data-key="+$(this.get("gTarget")).data("key")+"][data-unique=true]").length;if(r&&0<l)return layui.layer.msg("此组件只能创建一次！"),k.removeTip(),!1;var d=$(this.get("pTarget")).closest(this.toClassName("lDrag")).find('[data-unique="true"][data-key="U000055"], [data-unique="true"][data-key="U000056"]').length;if(!r&&0<d)return layui.layer.msg("请将组件放置到其他布局！"),k.removeTip(),!1;var c=$(this.get("gTarget")).data("key"),p=$(this.get("pTarget")).closest(this.toClassName("lDrag")).find(".geshop-component-box").length;if(r&&0<p&&-1!=$.inArray(c,["U000055","U000056"]))return layui.layer.msg("请将组件放置到空布局！"),k.removeTip(),!1;t="/activity/zf/ui-design/add-ui",a={page_id:$("#pageId").val(),layout_id:$(this.get("pTarget")).closest(this.toClassName("lDrag")).attr("id"),component_key:$(this.get("gTarget")).data("key"),position:$(this.get("pTarget")).closest("[data-position]").data("position"),lang:$("#pageLang").val()};var u=$(this.get("gTarget")).data("tplid");u&&(a.ui_tpl_id=u),i=function(e){if(k.disableLoading(),0===e.code){var t=e.data.async_data_info?e.data.async_data_info:[];window.GESHOP_ASYNC_DATA_INFO=Object.assign({},window.GESHOP_ASYNC_DATA_INFO),window.GESHOP_ASYNC_DATA_INFO[e.data.ui_id]=t,window.GESHOP_STORE&&GESHOP_STORE.commit("global/UPDATE_GOODS_INFO",window.GESHOP_ASYNC_DATA_INFO),"0"===sessionStorage.position?$(k.get("pTarget")).before(e.data.component_html):"1"===sessionStorage.position&&$(k.get("pTarget")).after(e.data.component_html),k.renderViewPage()}else layui.layer.msg(e.message);k.removeTip(),k.renderLayoutTitle()};s=$("#component_layout_add_position_tips",k.documentObject).prevAll(".geshop-component-box").attr("data-id");a.prev_id=void 0===s?0:s}n=function(e){k.disableLoading(),k.disableLayuiLoading(),layui.layer.msg(e.message)},this.postAjax(t,a,i,n)},k.dropLayout=function(){-1!==this.get("pTarget").className.indexOf(this.get("lDrag"))?this.dropInChild("layout"):-1!==this.get("pTarget").className.indexOf(this.get("lDrop"))&&this.dropInParent("layout")},k.dropComponent=function(){-1!==this.get("pTarget").className.indexOf(this.get("cDrag"))?this.dropInChild("component"):-1!==this.get("pTarget").className.indexOf(this.get("cDrop"))&&this.dropInParent("component")},k.drop=function(){return!!this.get("pTarget")&&(!($(this.get("pTarget")).closest(".design-view").length<=0)&&(-1!==this.get("gTarget").className.indexOf(this.get("lDrag"))&&this.dropLayout(),void(-1!==this.get("gTarget").className.indexOf(this.get("cDrag"))&&this.dropComponent())))},k.showDropTip=function(e,t,a){var i=t.offset().top,n=t.offset().left,o=t.outerWidth(),s=t.outerHeight();t.outerWidth()<340&&(e=""),$(".geshop-dragenter-tip-right",k.documentObject).removeClass("geshop-dragenter-tip-right"),$(".geshop-dragenter-tip-wrong",k.documentObject).removeClass("geshop-dragenter-tip-wrong"),t.addClass("geshop-dragenter-tip-"+a),$("#geshop_drop_tip_center p",k.documentObject).text(e),$("#geshop_drop_tip_center",k.documentObject).removeClass("geshop-drop-tip-center-right geshop-drop-tip-center-wrong"),$("#geshop_drop_tip_center",k.documentObject).css({top:i,left:n,width:o,height:s,fontSize:"14px"}).addClass("geshop-drop-tip-center-"+a).show()},k.hideDropTip=function(){$(".geshop-dragenter-tip-right",k.documentObject).removeClass("geshop-dragenter-tip-right"),$(".geshop-dragenter-tip-wrong",k.documentObject).removeClass("geshop-dragenter-tip-wrong"),$("#geshop_drop_tip_center p",k.documentObject).text(""),$("#geshop_drop_tip_center",k.documentObject).css({top:0,left:0,width:0,height:0}).removeClass("geshop-drop-tip-center-right geshop-drop-tip-center-wrong").hide()},k.getAjax=function(e,t){return k.enableLoading(),$.ajax({type:"GET",url:e,data:t,dataType:"json",error:function(){layui.layer.msg("接口异常,请稍后重试")},complete:function(e){k.disableLoading();var t=e.responseJSON;0!=t.code&&layui.layer.msg(t.message||"请求错误")}})},k.dateConverse=function(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},k.generageFormConfigFile=function(e){if(!e)return!1;var t={},a={is_public:e.is_public||0,is_m:e.is_m||0,is_app:e.is_app||0};return $(".design-form.design-form-component").find("input:not(.Unwanted),textarea").each(function(){var e=$(this).attr("name");t[e]=a}),JSON.stringify({fields:t})},k.getComponentFormData=function(){var s,r={},l={};return $(".design-form").find("input,select,textarea").each(function(e,t){var a=t.type.toLowerCase(),i=t.name,n=t.value,o=Boolean(t.getAttribute("data-public-tag"));$(this).hasClass("Unwanted")||("tpl_id"==i?t.checked&&(s=n):"checkbox"===a?0<i.length&&(o?(Array.isArray(r[i])||(r[i]=[]),t.checked&&r[i].push(n)):(Array.isArray(l[i])||(l[i]=[]),t.checked&&l[i].push(n))):"radio"==a?t.checked&&(o?r[i]=n:l[i]=n):o?r[i]=n:l[i]=n)}),{tpl_id:s,public:r,private:l}},k.openComponentForm=function(s,t,e){if(!e&&!t)return!1;k.enableLoading(),k.componentFormShow(),$.ajax({url:"/activity/zf/ui-design/get-form",type:"GET",data:{page_id:$("#pageId").val(),id:s,lang:$("#pageLang").val(),tpl_id:sessionStorage.getItem("currentTemplateId")},success:function(n){if(k.disableLoading(),0===n.code){0<$(".design-form-component").find(".geshop-form-content").length&&$(".design-form-component").find(".geshop-form-content").remove();var o=[],e=0;o.push('<div class="geshop-form-content">'),o.push(n.data.component_html),o.push("</div>"),t&&$(".design-form-component").hasClass("design-form-visible")&&($(".design-form-component").removeClass("design-form-visible"),e=300),setTimeout(function(){$("#component_form").prepend(o.join("")),$(".design-form-component").addClass("design-form-visible");var t=layui.form,e=layui.element,a=layui.carousel;t.render(),t.on("checkbox(check_all)",function(e){$("[name="+e.elem.getAttribute("data-name")+"]").prop("checked",e.elem.checked),t.render("checkbox")}),t.on("radio(templateId)",function(a){var e={page_id:$("#pageId").val(),id:sessionStorage.getItem("currentComponentId"),lang:$("#pageLang").val(),tpl_id:sessionStorage.getItem("currentTemplateId")},t=k.getComponentFormData();e.select_tpl_id=t.tpl_id,e.select_tpl_id!=sessionStorage.getItem("currentTemplateId")?e.private_data="{}":e.private_data=JSON.stringify(t.private),e.public_data=JSON.stringify(t.public),k.postAjax("/activity/zf/ui-design/save-form",e,function(e){if(k.disableLoading(),0===e.code){sessionStorage.setItem("currentTemplateId",a.elem.value);var t=$(k.toClassName("cDrag")+"[data-id="+sessionStorage.getItem("currentComponentId")+"]");t.after(e.data.select_component_html),t.remove(),k.openComponentForm(sessionStorage.getItem("currentComponentId"),!0,!0)}layui.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),layui.layer.msg(e.message)})}),e.render();var i=a.render({elem:"#form_carousel",width:"100%",height:"100%",arrow:"none",autoplay:!1,indicator:"none",index:0});$("body").on("click","#js_moreConfig",function(){$("#form_carousel>[carousel-item]>div").removeClass("layui-this"),i.reload({index:1})}).on("click","#js_baseConfig",function(){$("#form_carousel>[carousel-item]>div").removeClass("layui-this"),i.reload({index:0})}),k.renderColorPicker(),sessionStorage.setItem("currentComponentId",s),sessionStorage.setItem("currentTemplateId",n.data.tpl_id)},e)}else layui.layer.msg(n.message)},error:function(e){k.disableLoading(),k.componentFormHide(),layui.layer.msg("Error Code: "+e.status)}})},k.openCustomLayoutDialog=function(r,l,d){layui.layer.open({type:1,title:"添加布局",btn:["取消","确认"],btnAlign:"c",area:"640px",content:$("#custom_layout_template").html(),yes:function(e){layui.layer.close(e),k.removeTip()},btn2:function(t){if($('[type="radio"][name="width"][value="0"]').prop("checked")&&!Number($('[name="customWidth"]').val()))return layui.layer.msg("请设置布局宽度值(范围960-1920px)"),!1;if($('[type="radio"][name="column"][value="0"]').prop("checked")&&!Number($('[name="customColumn"]').val()))return layui.layer.msg("请设置列的数量(范围1-9列)"),!1;var e=!1;if($('[name^="customColumn"]').each(function(){Number($(this).val())||(e=!0)}),$('[type="radio"][name="type"][value="0"]').prop("checked")&&e)return layui.layer.msg("请设置列的宽度值(px)"),!1;var a,i={prev_id:l,page_id:$("#pageId").val(),component_key:$("#customLayoutKey").val(),width:"",columns:"",lang:$("#pageLang").val()},n=$('[type="radio"][name="width"]:checked').val();0===Number(n)?i.width=Number($('[name="customWidth"]').val()):i.width="100%"===n?n:String(n);var o=0,s=[];if(0===Number($('[type="radio"][name="column"]:checked').val()))if(0===Number($('[type="radio"][name="type"]:checked').val()))$('[name^="customColumnWidth"]').each(function(){"100%"===i.width?s.push(String($(this).val())+"%"):s.push(String($(this).val())+"px")});else if(o=Number($('[name="customColumn"]').val()),"100%"===i.width)for(a=0;a<o;a++)s.push(String(Number(100/o).toFixed(2))+"%");else for(a=0;a<o;a++)s.push(String(Number(i.width/o).toFixed(2))+"px");else if(o=Number($('[type="radio"][name="column"]:checked').val()),"100%"===i.width)for(a=0;a<o;a++)s.push(String(Number(100/o).toFixed(2))+"%");else for(a=0;a<o;a++)s.push(String(Number(i.width/o).toFixed(2))+"px");"100%"!==i.width&&(i.width+="px"),i.columns=s.join(","),k.postAjax("/activity/zf/layout-design/add-custom-layout",i,function(e){(k.disableLoading(),0===e.code)?($(".layout-drop").find("#component_layout_add_position_tips").length?$("#component_layout_add_position_tips").before(e.data.component_html):d?r.prepend(e.data.component_html):r.before(e.data.component_html),layui.layer.close(t)):layui.layer.msg(e.message);k.removeTip(),k.renderLayoutTitle()},function(e){k.disableLoading(),k.disableLayuiLoading(),layui.layer.msg(e.message)})},cancel:function(e){layui.layer.close(e),k.removeTip()}}),layui.form.render(),layui.form.on("radio(width)",function(e){0===Number(e.value)?$('[data-type="width"]').show():$('[data-type="width"]').hide(),k.renderCustomLayout()}),layui.form.on("radio(column)",function(e){0===Number(e.value)?$('[data-type="column"]').show():$('[data-type="column"]').hide(),k.renderCustomLayout()}),layui.form.on("radio(type)",function(){k.renderCustomLayout()}),$(document).on("change",'[name="customWidth"]',function(){k.renderCustomLayout()}).on("change",'[name="customColumn"]',function(){k.renderCustomLayout()}).on("change",'[name^="customColumnWidth"]',function(){var t=0,a=0,i=0,n=$('[name^="customColumnWidth"]'),o=n.length,e=$('[type="radio"][name="width"]:checked').val(),s=$('[name="customWidth"]').val();0!==Number(e)&&(s=e),n.each(function(e){Number($(this).val())?i+=Number($(this).val()):(t++,a=e)}),1===t?"100%"===s||Number(s)?n.get(a).value="100%"===s?100-i:s-i:layui.layer.msg("请设置布局宽度值(范围960-1920px)"):0===t&&(i=0,n.each(function(e){e<o-1&&(i+=Number($(this).val())),n.get(o-1).value="100%"===s?100-i:s-i}))})},k.renderColorPicker=function(){$(".color-picker-selector + input").each(function(){""==$(this).val()?$(this).prevAll(".color-picker-selector").find("div").addClass("transparent"):$(this).prevAll(".color-picker-selector").find("div").removeClass("transparent")}),$(".color-picker-selector + input").change(function(){var e=$.trim($(this).val());0==e.length?($(this).val("transparent"),$(this).prevAll(".color-picker-selector").find("div").addClass("transparent")):($(this).prevAll(".color-picker-selector").find("div").css("backgroundColor",e).removeClass("transparent"),$(this).prevAll(".color-picker-selector").ColorPickerSetColor(e))}),$(".color-picker-selector").ColorPicker({onBeforeShow:function(){$(this).ColorPickerSetColor($(this).next("[name="+$(this).data("hiddenName")+"]").val())},onShow:function(e){return $(e).fadeIn(500),!1},onHide:function(e){return $(e).fadeOut(500),!1},onSubmit:function(e,t,a,i){$(i).find("div").css("backgroundColor","#"+t).removeClass("transparent"),$(i).next("[name="+$(i).data("hiddenName")+"]").val("#"+t),$(i).ColorPickerHide()}})},k.renderCustomLayout=function(){var e=$('[type="radio"][name="width"]:checked').val(),t=Number($('[type="radio"][name="column"]:checked').val()),a=0;if(0===Number(e)&&(e=$('[name="customWidth"]').val()),"100%"===e||Number(e)||layui.layer.msg("请设置布局宽度值(范围960-1920px)"),a=0===Number(t)?$("[name=customColumn]").val():t,Number(a)||layui.layer.msg("请设置列的数量(范围1-9列)"),0===t&&Number(a)&&0===Number($('[type="radio"][name="type"]:checked').val())){for(var i="",n=0;n<a;n++)i+='<input type="text" name="customColumnWidth'+n+'" autocomplete="off" class="layui-input" style="display: inline; width: 64px;">',n<a-1&&(i+="100%"===e?"% + ":"px + ");i+="100%"===e?"% = "+e:"px = "+String(e)+"px",$('[data-type="type"] .layui-input-block').html(i),$('[data-type="type"]').show(),layui.form.render()}else $('[data-type="type"]').hide(),$("[type=radio][name=type][value=1]").prop("checked",!0),$("[type=radio][name=type][value=0]").prop("checked",!1),layui.form.render()},k.renderDatetime=function(){$(".js_start_time").each(function(){var a=this;layui.laydate.render({elem:a,type:"datetime",done:function(e){var t=Date.parse(new Date(e));if(Date.parse(new Date($(a).nextAll(".js_end_time").val()))<=t)return layui.layer.msg("开始时间不能大于结束时间",{time:5e3}),!1}})}),$(".js_end_time").each(function(){var a=this;layui.laydate.render({elem:a,type:"datetime",done:function(e){var t=Date.parse(new Date($(a).prevAll(".js_start_time").val()));if(Date.parse(new Date(e))<=t)return layui.layer.msg("开始时间不能大于结束时间",{time:5e3}),!1}})})},k.renderLayoutTitle=function(){$(".geshop-layout-box",k.documentObject).each(function(){var e=$(this).data("key");$(this).find(".component-drop").each(function(){0<$(this).find(".geshop-component-box").length?$(this).find(".design-preview-layout-title").remove():0==$(this).find(".design-preview-layout-title").length&&$(this).prepend('<p class="design-preview-layout-title">'+$("#design_drag [data-key="+e+"]").data("name")+"</p>")})})},k.renderViewPage=function(){$("#design_to_view").hasClass("layui-btn-normal")&&$(".geshop-component-box").each(function(){$(this).addClass("design-preview-box"),$(this).find("> *").addClass("design-preview-hidden");var e=$(this).data("key");$(this).prepend('<p class="design-preview-content">'+$("#design_drag [data-key="+e+"]").data("name")+"</p>")})},k.initializeResourceDialog=function(e){$("#geshop_resoure_list").html(resourceList),!1!==e&&$("#layui-layer"+e+" .layui-layer-content").css("height","calc(100% - 63px)"),0<resourceTree.length?k.renderResourceTree():$.get("/admin/resource/folder-tree",function(e){resourceTree=e.data,k.renderResourceTree()}),k.initializeResourceUpload()},k.initializeResourceUpload=function(){layui.upload.render({elem:"#upload_resource",multiple:!0,data:{parent_id:function(){return sessionStorage.getItem("currentResourceId")}},field:"files",url:"/admin/resource/multi-file-upload",before:function(){sessionStorage.getItem("currentResourceId")&&0!=Number(sessionStorage.getItem("currentResourceId"))?k.enableLayuiLoading():$("#empty_tip").show()},done:function(e){k.disableLayuiLoading(),0===e.code?k.renderResourceExploere(sessionStorage.getItem("currentResourceId"),"/admin/resource/list"):layui.layer.msg(e.message)},error:function(){k.disableLayuiLoading(),layui.layer.msg("接口错误！")}})},k.renderResourceExploere=function(a,e){k.enableLayuiLoading(),$.get(e,{id:a},function(e){if(k.disableLayuiLoading(),0===e.code){var t=[];0<e.data.list.length&&e.data.list.forEach(function(e){1===Number(e.type)&&(t.push('<div class="layui-col-xs2 geshop-resource-explorer-col" style="width: 118px; text-align: center;">'),t.push('<p style="position: relative;">'),t.push('<img src="'+e.thumbnail_url+'" width="100" style="max-height: 100px;">'),t.push('<span style="display: block; position: absolute; left: 8px; right: 8px; bottom: -20px; background-color: #f4f4f4; height: 20px; line-height: 20px; font-size: 12px; color: #333333;">'+e.width+"X"+e.height+"</span>"),t.push("</p>"),t.push('<p class="geshop-resource-explorer-title">'+e.name+"</p>"),t.push('<div class="geshop-resource-operate">'),t.push('<a href="javascript:;" class="js_useResource" data-url="'+e.url+'" data-width="'+e.width+'" data-height="'+e.height+'">使用</a>'),t.push("</div>"),t.push("</div>"))}),0==t.length&&(t.push('<div class="layui-col-xs12">'),t.push("<p>暂无数据</p>"),t.push("</div>")),resourceList=t.join(""),0===Number(a)&&0==$(".geshop-resource-explorer").length?layui.layer.open({maxmin:!0,type:1,title:"素材管理器",area:["920px","600px"],content:$("#resource_view_template").html(),success:function(e,t){k.initializeResourceDialog(t)},cancel:function(){sessionStorage.setItem("currentResourceId",0)}}):$("#geshop_resoure_list").html(resourceList)}})},k.renderResourceTree=function(){$.jstree.destroy(),$("#geshop_resource_tree").on("changed.jstree",function(e,t){t.node&&sessionStorage.setItem("currentResourceId",t.node.id),$("#empty_tip").hide(),k.renderResourceExploere(t.node.id,"/admin/resource/list")}).jstree({core:{data:resourceTree}})},window.Design=k,window.interface_code="zf";var o,w=window.$,C=window.layui;window.resourceTree=[],window.resourceList="",k.renderLayoutTitle(),k.enableLoading("rgba(255, 255, 255, .3)");var x="pc",p=!1;if("dl"==k.site_code){var L={pcData:{pColumn:1,isCustomColumn:1,inputData:[]},mData:{mColumn:1,isCustomNumber:1,inputData:[]}};k.openCustomLayoutDialog=function(v,_,b){C.layer.open({type:1,title:"添加布局",btn:["取消","确认"],btnAlign:"c",area:"640px",content:w("#custom_layout_template").html(),yes:function(e){C.layer.close(e),k.removeTip()},btn2:function(t){var e=!1,a=!1;if(w('[type="radio"][name="width"][value="0"]').prop("checked")&&!Number(w('[name="customWidth"]').val()))return C.layer.msg("请设置自定义布局宽度百分比(范围10-100)"),!1;if(w('[type="radio"][name="width"][value="0"]').prop("checked")){var i=w('[name="customWidth"]'),n=i.val();if(""!=n&&(n<10||100<n))return C.layer.msg("请设置自定义布局宽度百分比(范围10-100)"),i.val(""),!1}if(w('[type="radio"][name="column"][value="0"]').prop("checked")&&!Number(w('[name="customColumn"]').val()))return C.layer.msg("请设置列的数量(范围1-9列)"),!1;if("pc"==x){if(w('[name^="customColumnWidth"]').each(function(){Number(w(this).val())||(e=!0)}),w('[type="radio"][name="type"][value="0"]').prop("checked")&&e)return C.layer.msg("请设置列的自定义百分比！"),!1}else if("m"==x){if(w('[name^="customColumn_m_Width"]').each(function(){Number(w(this).val())||(a=!0)}),w('[type="radio"][name="typem"][value="0"]').prop("checked")&&a)return C.layer.msg("请设置M自定义百分比！"),!1;if(w('[type="radio"][name="type"][value="0"]').prop("checked")&&(w('[name^="customColumnWidth"]').each(function(){Number(w(this).val())||(e=!0)}),w('[type="radio"][name="type"][value="0"]').prop("checked")&&e))return C.layer.msg("请设置PC+PAD自定义百分比！"),!1}var o,s="/activity/"+k.site_code+"/layout-design/add-custom-layout",r={prev_id:_,page_id:w("#pageId").val(),component_key:w("#customLayoutKey").val(),width:"",columns:"",wap_width:"",wap_columns:"",lang:w("#pageLang").val()},l=0,d=0,c=w('[type="radio"][name="width"]:checked').val(),p=Number(w('[name="customWidth"]').val()),u=Number(w('[type="radio"][name="column"]:checked').val()),g=Number(w('[type="radio"][name="column_m"]:checked').val());"90%"===c?(l=Number(10/u).toFixed(2),d=Number(10/g).toFixed(2)):"80%"===c?(l=Number(20/u),d=Number(20/u)):0===Number(c)&&(l=Number((100-p)/u),d=Number((100-p)/g)),0===Number(c)?(r.width=Number(w('[name="customWidth"]').val())+"%",r.wap_width=Number(w('[name="customWidth"]').val())+"%"):(r.width=c,r.wap_width=c);var m=0,y=0,h=[],f=[];if(0===Number(w('[type="radio"][name="type"]:checked').val()))w('[name^="customColumnWidth"]').each(function(){"100%"===r.width?h.push(String(w(this).val())+"%"):h.push(Number(w(this).val())+Number(l)+"%")});else if(m=Number(w('[type="radio"][name="column"]:checked').val()),"100%"===r.width)for(o=0;o<m;o++)h.push(String(Number(100/m).toFixed(2))+"%");else if("90%"===r.width)for(o=0;o<m;o++)h.push(String(Number(100/m).toFixed(2))+"%");else if("80%"===r.width)for(o=0;o<m;o++)h.push(String(Number(100/m).toFixed(2))+"%");else for(o=0;o<m;o++)h.push(String(Number(100/m).toFixed(2))+"%");if(0===Number(w('[type="radio"][name="typem"]:checked').val()))w('[name^="customColumn_m_Width"]').each(function(){"100%"===r.width?f.push(String(w(this).val())+"%"):f.push(Number(w(this).val())+Number(d)+"%")});else if(y=Number(w('[type="radio"][name="column_m"]:checked').val()),"100%"===r.width)for(o=0;o<y;o++)f.push(String(Number(100/y).toFixed(2))+"%");else if("90%"===r.width)for(o=0;o<y;o++)f.push(String(Number(100/y).toFixed(2))+"%");else if("80%"===r.width)for(o=0;o<y;o++)f.push(String(Number(100/y).toFixed(2))+"%");else for(o=0;o<y;o++)f.push(String(Number(100/y).toFixed(2))+"%");r.columns=h.join(","),r.wap_columns=f.join(","),k.postAjax(s,r,function(e){(k.disableLoading(),0===e.code)?(w(".layout-drop").find("#component_layout_add_position_tips").length?w("#component_layout_add_position_tips").before(e.data.component_html):b?1<=w(v).find("#component_layout_add_position_tips").length?w(v).find("#component_layout_add_position_tips").after(e.data.component_html):v.prepend(e.data.component_html):v.before(e.data.component_html),L.pcData.pColumn=1,L.pcData.isCustomColumn=1,L.pcData.inputData=[],L.mData.mColumn=1,L.mData.isCustomNumber=1,L.mData.inputData=[],C.layer.close(t)):C.layer.msg(e.message);x="pc",k.removeTip(),k.renderLayoutTitle()},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)}),x="pc"},cancel:function(e){C.layer.close(e),k.removeTip()}}),C.form.render(),C.form.on("radio(width)",function(e){L.pcData.inputData=[],L.mData.inputData=[],0===Number(e.value)?w('[data-type="width"]').show():w('[data-type="width"]').hide(),k.renderCustomLayout()}),C.element.on("tab(tab-brief)",function(e){if(1===e.index){x="m",w(".layui-form-m").find(".layui-column:eq(0)").show();var t=L.mData.mColumn;w('[type=radio][name=column_m][value="'+t+'"]').length?w('[type=radio][name=column_m][value="'+t+'"]').prop("checked",!0):w("[type=radio][name=column_m][value=1]").prop("checked",!0),L.pcData.inputData=[],w('input[name^="customColumnWidth"]').each(function(e,t){L.pcData.inputData.push(w(t).val())}),C.form.render()}else{x="pc",L.mData.inputData=[],w('input[name^="customColumn_m_Width"]').each(function(e,t){L.mData.inputData.push(w(t).val())}),1==p&&(w('[data-type="typem"]').hide(),w("[type=radio][name=typem][value=1]").prop("checked",!0),w("[type=radio][name=typem][value=0]").prop("checked",!1),C.form.render())}k.renderCustomLayout()}),C.form.on("radio(column)",function(e){var t=w(".layui-form-m").find(".layui-column"),a=e.elem.getAttribute("data-col").split(",");L.pcData.pColumn=Number(e.value),L.pcData.inputData=[],L.mData.mColumn=1,L.mData.isCustomNumber=1,L.mData.inputData=[],t.hide(),a.forEach(function(a,e){t.each(function(e,t){w(t).data("val")==a&&w(t).show()})}),k.renderCustomLayout()}),C.form.on("radio(column_m)",function(e){L.mData.inputData=[],L.mData.mColumn=Number(e.value),k.renderCustomLayout()}),C.form.on("radio(type)",function(e){L.pcData.isCustomColumn=Number(e.value),k.renderCustomLayout()}),C.form.on("radio(typem)",function(e){L.mData.isCustomNumber=Number(e.value),k.renderCustomLayout()}),w(document).on("change",'[name="customWidth"]',function(){k.renderCustomLayout()}).on("change",'[name="customColumn"]',function(){k.renderCustomLayout()}).on("change",'[name="customColumnM"]',function(){k.renderCustomLayout()}).on("change",'[name^="customColumnWidth"]',function(){var a=0,i=0,n=0,o=w('[name^="customColumnWidth"]'),s=o.length,e=w('[type="radio"][name="width"]:checked').val(),r=w('[name="customWidth"]').val();if(0!==Number(e)&&(r=e),o.each(function(e,t){w(t);Number(w(this).val())?n+=Number(w(this).val()):(a++,i=e)}),n>r.replace("%",""))return C.layer.msg("请输入合适的宽度百分比!"),w(this).val(""),!1;if(""!=w(this).val())if(1===a)if("100%"===r||"90%"===r||"80%"===r||Number(r))if("100%"===r){var t=o.get(i).value=100-n;t=o.get(i).value=0===t?"":100-n}else if("90%"===r){t=o.get(i).value=90-n;o.get(i).value=0===t?"":90-n}else if("80%"===r){t=o.get(i).value=80-n;o.get(i).value=0===t?"":80-n}else{t=o.get(i).value=r-n;o.get(i).value=0===t?"":r-n}else C.layer.msg("请设置布局宽度值(范围10-100)");else 0===a&&(n=0,o.each(function(e){if(e<s-1&&(n+=Number(w(this).val())),"100%"===r){var t=o.get(s-1).value=100-n;o.get(s-1).value=0===t?"":100-n}else if("90%"===r){t=o.get(s-1).value=90-n;o.get(s-1).value=0===t?"":90-n}else if("80%"===r){t=o.get(s-1).value=80-n;o.get(s-1).value=0===t?"":80-n}else{t=o.get(s-1).value=r-n;o.get(s-1).value=0===t?"":r-n}}))}).on("change",'[name^="customColumn_m_Width"]',function(){var t=0,a=0,i=0,n=w('[name^="customColumn_m_Width"]'),o=n.length,e=w('[type="radio"][name="width"]:checked').val(),s=w('[name="customWidth"]').val();if(0!==Number(e)&&(s=e),n.each(function(e){Number(w(this).val())?i+=Number(w(this).val()):(t++,a=e)}),i>s.replace("%",""))return C.layer.msg("请输入合适的宽度百分比!"),w(this).val(""),!1;if(""!=w(this).val())if(1===t)if("100%"===s||"90%"===s||"80%"===s||Number(s))if("100%"===s){var r=n.get(a).value=100-i;n.get(a).value=0===r?"":100-i}else if("90%"===s){r=n.get(a).value=90-i;n.get(a).value=0===r?"":90-i}else if("80%"===s){r=n.get(a).value=80-i;n.get(a).value=0===r?"":80-i}else{r=n.get(a).value=s-i;n.get(a).value=0===r?"":s-i}else C.layer.msg("请设置布局宽度值(范围10-100)");else 0===t&&(i=0,n.each(function(e){if(e<o-1&&(i+=Number(w(this).val())),"100%"===s){var t=n.get(o-1).value=100-i;n.get(o-1).value=0===t?"":100-i}else if("90%"===s){t=n.get(o-1).value=90-i;n.get(o-1).value=0===t?"":90-i}else if("80%"===s){t=n.get(o-1).value=80-i;n.get(o-1).value=0===t?"":80-i}else{t=n.get(o-1).value=s-i;n.get(o-1).value=0===t?"":s-i}}))})},k.renderCustomLayout=function(){var e,t,a=w('[type="radio"][name="width"]:checked').val(),i=Number(w('[type="radio"][name="column"]:checked').val()),n=Number(w('[type="radio"][name="column_m"]:checked').val());Number(w('[type="radio"][name="type"]:checked').val()),Number(w('[type="radio"][name="typem"]:checked').val());if(0===Number(a)&&(a=w('[name="customWidth"]').val()),"100%"===a||"90%"===a||"80%"===a||Number(a)||C.layer.msg("请设置自定义布局宽度百分比(范围10-100)"),e=i,t=n,Number(e)||C.layer.msg("请设置列的数量(范围1-4列)",{time:3}),Number(t)||C.layer.msg("请设置列的数量(范围1-4列)",{time:3}),"pc"===x)if(0===L.pcData.isCustomColumn&&Number(e)){for(var o="",s=0;s<e;s++)o+='<input type="text" name="customColumnWidth'+s+'" autocomplete="off" class="layui-input" style="display: inline; width: 64px;" maxlength="3">',s<e-1&&(o+=" % + ");if(o+="100%"===a||"90%"===a||"80%"===a?" % = "+a:" % = "+String(a)+" %",w('[data-type="type"] .layui-input-block').html(o),w('[data-type="type"]').show(),0<L.pcData.inputData.length)for(var r=w('input[name^="customColumnWidth"]'),l=0;l<L.pcData.inputData.length;l++)r.eq(l).val(L.pcData.inputData[l]);C.form.render()}else w('[data-type="type"]').hide(),w("[type=radio][name=type][value=1]").prop("checked",!0),w("[type=radio][name=type][value=0]").prop("checked",!1),C.form.render();else if("m"===x)if(0===L.mData.isCustomNumber&&Number(t)){var d="";p=!0;for(var c=0;c<t;c++)d+='<input type="text" name="customColumn_m_Width'+c+'" autocomplete="off" class="layui-input" style="display: inline; width: 64px;" maxlength="3">',c<t-1&&(d+=" % + ");if(d+="100%"===a||"90%"===a||"80%"===a?" % = "+a:" % = "+String(a)+" %",w('[data-type="typem"] .layui-input-block').html(d),w('[data-type="typem"]').show(),w("[type=radio][name=typem][value=0]").prop("checked",!0),w("[type=radio][name=typem][value=1]").prop("checked",!1),0<L.mData.inputData.length)for(r=w('input[name^="customColumn_m_Width"]'),l=0;l<L.mData.inputData.length;l++)r.eq(l).val(L.mData.inputData[l]);C.form.render()}else w('[data-type="typem"]').hide(),w("[type=radio][name=typem][value=1]").prop("checked",!0),w("[type=radio][name=typem][value=0]").prop("checked",!1),C.form.render()}}w(function(){var r={lastMousePageY:0,dragStatus:0};k.disableLoading(),w("#design_drag, #design_view").click(function(e){w(e.target).closest(".design-form").length<=0&&!w(e.target).hasClass("component-drag-mask")&&w(".design-form").removeClass("design-form-visible")}),w("#js_toggleLeft,#js_toggleLeft_2").click(function(){w(".design-left-box").css("width","80px"),w(".design-control").css("left","80px"),w(".sidebar-btn").removeClass("current"),w(".template-item-select-container").hide()}),w(".js_tmpCancelSelect").click(function(){w("#js_toggleLeft_2").trigger("click")}),w(".sidebar-btn").click(function(){var e=w(this).index();w(this).addClass("current").siblings().removeClass("current"),w(".sidebar-container .sidebar-content").eq(e).show().siblings(".sidebar-content").hide(),w("#design_drag").addClass("design-left-box-visible"),2==e?w(".template-item-select-container").show():w(".template-item-select-container").hide(),1==e||2==e||3==e?(w(".design-left-box-visible").css("width","408px"),w(".design-control").css("left","400px")):(w(".design-left-box-visible").css("width","240px"),w(".design-control").css("left","240px"))}),w(".sidebar-template-list-container").on("click",".template-list-item",function(){1==w(this).parent().data("type")?w(".sidebar-component-container[data-type=2]").children(".template-list-item").removeClass("checked"):w(".sidebar-component-container[data-type=1]").children(".template-list-item").removeClass("checked"),w(this).addClass("checked").siblings().removeClass("checked")}),w(".template-item-select-container").on("click",".js_tmpConfirmSelect",function(){var e=w(".sidebar-template-list-container .template-list-item.checked");if(e.length){var t=e.data("id");C.layer.confirm("切换所需模板后，参数会被替换。",{btn:["取消","确定"],area:"420px",icon:3,skin:"element-ui-dialog-class"},function(e){C.layer.close(e)},function(){w.post("/activity/"+interface_code+"/page-tpl/confirm-tpl",{tpl_id:t,page_id:w("#pageId").val(),lang:w("#pageLang").val()},function(e){C.layer.msg(e.message),0===e.code&&window.location.reload()})})}else C.layer.msg("请先选择模板！")}),w(".sidebar-list-title i").on("click",function(){var e=w(this).parent();e.next().is(":visible")?(e.addClass("open"),e.next().hide()):(e.removeClass("open"),e.next().show(),e.parent(".sidebar-list-container").siblings(".sidebar-list-container").find(".sidebar-list-title").addClass("open").next().hide())}),w(".sidebar-child-list-title i").on("click",function(){var e=w(this).parent();e.next().is(":visible")?(e.addClass("open"),e.next().hide()):(e.removeClass("open"),e.next().show(),e.siblings(".sidebar-child-list-title").addClass("open").next().hide())}),w("#sync_goodsList").click(function(){C.layer.confirm("是否同步英文版商品sku？",{btn:["否","是"],area:"420px",icon:3,skin:"element-ui-dialog-class"},function(e){C.layer.close(e)},function(t){w.ajax({url:"/activity/"+interface_code+"/design/copy-sku",type:"POST",data:{lang:w("#pageLang").val(),page_id:w("#pageId").val()},success:function(e){e.message&&C.layer.msg(e.message),C.layer.close(t),0==e.code&&window.location.reload()},error:function(e){e&&e.responseJSON&&C.layer.msg(e.responseJSON.message),C.layer.close(t)}})})}),w("#sync_config").click(function(){C.layer.confirm("是否同步英文版数据配置？",{btn:["否","是"],area:"420px",icon:3,skin:"element-ui-dialog-class"},function(e){C.layer.close(e)},function(t){w.get("/activity/"+interface_code+"/design/copy-page",{lang:w("#pageLang").val(),page_id:w("#pageId").val()},function(e){0==e.code?window.location.reload():(C.layer.msg(e.message),C.layer.close(t))})})});var s=0;w("#add_page_stylesheet").click(function(){w.get("/activity/"+interface_code+"/design/get-setting",{page_id:w("#pageId").val(),lang:w("#pageLang").val()},function(o){0==o.code?C.layer.open({type:1,title:"添加页面样式",btn:["取消","确认"],btnAlign:"c",offset:"180px",area:"880px",content:w("#page_stylesheet_template").html(),success:function(){var e=o.data.general.style_type;1==e?(w(".page-system-settings-container").show(),w(".page-custom-settings-container").hide()):2==e&&(w(".page-custom-settings-container").show(),w(".page-system-settings-container").hide());var t=w(".page-stylesheet-list-container .layui-tab-item:eq(0)");t.find(".page-style-select-container input[value="+o.data.general.style_type+"]").prop("checked",!0),t.find("[name=page_custom_css]").val(o.data.general.custom_css),t.find("[name=page_background_color]").val(o.data.general.background_color),t.find("[name=page_background_color]").prev().find("div").css("backgroundColor",o.data.general.background_color),t.find("[name=page_background_image]").val(o.data.general.background_image),o.data.general.background_image?(t.find(".page-background-repeat").show(),t.find(".page-position-repeat").show()):(t.find(".page-background-repeat").hide(),t.find(".page-position-repeat").hide()),0<o.data.general.background_repeat.length&&t.find('[name=page_background_repeat][value="'+o.data.general.background_repeat+'"]').prop("checked",!0),0<o.data.general.background_position.length&&t.find('a.page-background-position[data-value="'+o.data.general.background_position+'"]').addClass("current").siblings().removeClass("current");var a="",i="",n=o.data.list;null!=n&&(n.forEach(function(e,t){a+='<li lay-id="'+(t+1)+'">'+e.class_name+"</li>",i+='<div class="layui-tab-item"><div class="layui-form-item"><div class="layui-input-block layui-form-title">样式名称</div><div class="layui-input-block"><input type="text" class="layui-input class-name" style="width:406px" name="" autocomplete="off" value="'+e.class_name+'"></div></div><div class="layui-form-item" style="margin-top: 8px;"><div class="layui-input-block layui-form-title">时间设置</div><div class="layui-input-block" style="position:relative;width:406px"><span class="time-icon"></span><input type="text" class="layui-input start-time js_start_time" style="display:inline;width:203px;border-right:none" name="" autocomplete="off" value="'+k.dateConverse(e.start_time)+'"><span class="time-split">至</span><input type="text" class="layui-input end-time js_end_time" style="display:inline;width:203px;border-left:none;margin-left:-1px" name="" autocomplete="off" value="'+k.dateConverse(e.end_time)+'"><span class="time-settings-tips">（注:时间段不要与其他页面样式出现交集哦）</span></div></div><div class="layui-form-item page-style-select-container" style="margin-top: 8px;"><div class="layui-input-block layui-form-title">页面样式选择<span style="margin-left:10px;color:#9E9E9E;font-size:12px;">（注：当无任何切换的时间段时，页面样式按照通用样式设置进行展示）</span></div><div class="layui-input-block">',1==e.style_type?i+='<input type="radio" name="page_style_select_'+(t+1)+'" lay-filter="system-custom-settings" value="1" title="系统设置" checked><input type="radio" name="page_style_select_'+(t+1)+'" lay-filter="system-custom-settings" value="2" title="自定义设置">':2==e.style_type&&(i+='<input type="radio" name="page_style_select_'+(t+1)+'" lay-filter="system-custom-settings" value="1" title="系统设置"><input type="radio" name="page_style_select_'+(t+1)+'" lay-filter="system-custom-settings" value="2" title="自定义设置" checked>'),i+="</div></div>",1==e.style_type?i+='<div class="page-system-settings-container" style="margin-top: -4px;">':i+='<div class="page-system-settings-container" style="display:none;margin-top: -4px;">',i+='<div class="layui-form-item"><div class="layui-input-block layui-form-title">整体页面背景颜色</div><div class="layui-input-block"><div class="color-picker-selector" data-hidden-name="page_background_color"><div style="background-color:'+(e.style.background_color?e.style.background_color:"transparent")+'"></div></div><input type="text" class="layui-input background-color" style="width:406px" name="page_background_color" autocomplete="off" value="'+(e.style.background_color?e.style.background_color:"")+'"></div></div><div class="layui-form-item" style="margin-top: 4px;"><div class="layui-input-block layui-form-title">整体页面背景图片</div><div class="layui-input-block"><a href="javascript:;" class="js_openResource design-open-resource" data-type="tabBgImg"><i class="layui-icon">&#xe64a;</i></a><input type="text" name="page_background_image" style="width:406px" autocomplete="off" class="layui-input background-image" value="'+(e.style.background_image?e.style.background_image:"")+'"></div></div>',e.style.background_image?i+='<div class="layui-form-item page-background-repeat" style="display:block;margin-top: 8px;">':i+='<div class="layui-form-item page-background-repeat" style="display:none;margin-top: 8px;">',i+='<div class="layui-input-block layui-form-title">平铺方式</div><div class="layui-input-block">',1==e.style_type?("no-repeat"==e.style.background_repeat?i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="no-repeat" title="不平铺" checked>':i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="no-repeat" title="不平铺">',"repeat"==e.style.background_repeat?i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat" title="平铺" checked>':i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat" title="平铺">',"repeat-x"==e.style.background_repeat?i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat-x" title="横向平铺" checked>':i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat-x" title="横向平铺">',"repeat-y"==e.style.background_repeat?i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat-y" title="纵向平铺" checked>':i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat-y" title="纵向平铺">'):2==e.style_type&&(i+='<input type="radio" name="page_background_repeat_'+(t+1)+'" value="no-repeat" title="不平铺"><input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat" title="平铺" checked><input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat-x" title="横向平铺"><input type="radio" name="page_background_repeat_'+(t+1)+'" value="repeat-y" title="纵向平铺">'),i+="</div></div>",e.style.background_image?i+='<div class="layui-form-item page-position-repeat" style="display:block;margin-top: -4px;">':i+='<div class="layui-form-item page-position-repeat" style="display:none;margin-top: -4px;">',i+='<div class="layui-input-block layui-form-title">对齐方式</div><div class="layui-input-block">',1==e.style_type?("top"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="top"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="top"></a>',"right"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="right"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="right"></a>',"bottom"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="bottom"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="bottom"></a>',"left"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="left"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="left"></a>',"center"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="center"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="center"></a>',"top left"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="top left"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="top left"></a>',"top right"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="top right"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="top right"></a>',"buttom left"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="buttom left"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="buttom left"></a>',"bottom right"==e.style.background_position?i+='<a href="javascript:;" class="page-background-position current" data-value="bottom right"></a>':i+='<a href="javascript:;" class="page-background-position" data-value="bottom right"></a>'):2==e.style_type&&(i+='<a href="javascript:;" class="page-background-position" data-value="top"></a>',i+='<a href="javascript:;" class="page-background-position" data-value="right"></a>',i+='<a href="javascript:;" class="page-background-position" data-value="bottom"></a>',i+='<a href="javascript:;" class="page-background-position" data-value="left"></a>',i+='<a href="javascript:;" class="page-background-position current" data-value="center"></a>',i+='<a href="javascript:;" class="page-background-position" data-value="top left"></a>',i+='<a href="javascript:;" class="page-background-position" data-value="top right"></a>',i+='<a href="javascript:;" class="page-background-position" data-value="buttom left"></a>',i+='<a href="javascript:;" class="page-background-position" data-value="bottom right"></a>'),i+="</div></div></div>",2==e.style_type?i+='<div class="page-custom-settings-container" style="display:block">':i+='<div class="page-custom-settings-container" style="display:none">',i+='<div class="layui-form-item custom-settings-stylesheet"><div class="layui-input-block layui-form-title">页面样式</div><div class="layui-input-block">',2==e.style_type?i+='<textarea name="page_custom_css" style="width:800px" placeholder="请输入样式代码" class="layui-textarea">'+e.style.custom_css+"</textarea>":i+='<textarea name="page_custom_css" style="width:800px" placeholder="请输入样式代码" class="layui-textarea"></textarea>',i+="</div></div></div></div>"}),w(".page_style_option_bar .layui-tab-title li").after(a),w(".page-stylesheet-list-container .layui-tab-item").after(i)),k.renderDatetime(),C.element.render("tab"),s=w(".page_style_option_bar .layui-tab-title li").length,C.form.render(),k.renderColorPicker()},btn2:function(){var e,t="/activity/"+interface_code+"/design/setting",a={page_id:w("#pageId").val(),lang:w("#pageLang").val()},s=[],r=!1,l=!1,i=w(".page-stylesheet-list-container .layui-tab-item:eq(0)"),n=i.find(".page-style-select-container input:checked").val(),o=i.find("textarea[name=page_custom_css]").val(),d=i.find("[name=page_background_color]").val(),c=i.find("[name=page_background_image]").val(),p=i.find(".page-background-repeat input[type=radio]:checked").val(),u=i.find("a.page-background-position.current").data("value");a.general={style_type:Number(n)},1==n?(a.general.background_color=d,a.general.background_image=c,a.general.background_repeat=p,a.general.background_position=u):2==n&&(a.general.custom_css=o),a.custom={};var g=[],m=[];w(".page-stylesheet-list-container .layui-tab-item:gt(0)").each(function(){w(this).index();var e={},t=w(this).find(".page-style-select-container input:checked").val(),a=w(this).find("input.start-time").val(),i=w(this).find("input.end-time").val(),n=Date.parse(new Date(a)),o=Date.parse(new Date(i));return e.style_type=Number(t),e.class_name=w(this).find("input.class-name").val(),""==a||""==i?(r=!1,C.layer.msg("请设置时间，不设置请先删除对应tab页签"),!1):(r=!0,n<=o?(g.push(n),m.push(o),e.start_time=n,e.end_time=o,l=!0,1==t?e.style={background_color:w(this).find("[name=page_background_color]").val(),background_image:w(this).find("[name=page_background_image]").val(),background_repeat:w(this).find(".page-background-repeat input[type=radio]:checked").val(),background_position:w(this).find("a.page-background-position.current").data("value")}:2==t&&(e.style={custom_css:w(this).find("[name=page_custom_css]").val()}),void s.push(e)):(l=!1,C.layer.msg("开始时间必须小于结束时间！"),!1))}),a.custom.list=s;function y(e){k.disableLoading(),0==e.code?C.layer.msg("页面样式保存成功，请到预览页面查看效果！"):C.layer.msg(e.data)}function h(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)}return a.general=JSON.stringify(a.general),a.custom=JSON.stringify(a.custom),e=function(e,t){e=e.sort(),t=t.sort();for(var a=1;a<e.length;a++)if(e[a]<t[a-1])return C.layer.msg("时间段不能与其他页面样式出现交集",{time:5e3}),!1;return!0}(g,m),1==w(".page-stylesheet-list-container .layui-tab-item").length?k.postAjax(t,a,y,h):r&&l&&e&&k.postAjax(t,a,y,h),!1},cancel:function(e){C.layer.close(e)}}):C.layer.msg(o.message)})}),w("#generate_page_model").click(function(){C.layer.open({title:"新增页面模板",btn:["取消","确认"],type:"1",area:"720px",btnAlign:"c",content:w("#page_model_template").html(),success:function(){C.form.render(),C.upload.render({elem:"#upload_model_picture",field:"files",url:"/home/zf/page-tpl/upload-pic",accept:"images",exts:"jpg|png|gif|bmp|jpeg|wepb",size:3072,before:function(){k.enableLayuiLoading()},done:function(e){if(k.disableLayuiLoading(),0===e.code){w("[name=model_pic").val(e.data.url);var t=e.data.url;w("#upload_model_picture").css("background-image","url("+t+")"),w("#upload_model_picture>i").css("opacity","0"),w("#upload_model_picture>p").css("opacity","0")}else C.layer.msg(e.message)},error:function(){k.disableLayuiLoading(),C.layer.msg("接口错误！")}})},yes:function(e){C.layer.close(e)},btn2:function(t){var e={pageId:w("#pageId").val(),lang:w("#pageLang").val(),name:w("[name=model_name]").val(),pic:w("[name=model_pic]").val(),site_code:w("#siteCode").val(),pid:window.location.search.substr(5,window.location.search.length),type:w("select[name=model_type]").val()};if(""==e.name)return C.layer.msg("名称不能为空"),!1;if(50<e.name.length)return C.layer.msg("名称不能超过50个字符"),!1;k.postAjax("/activity/zf/page-tpl/add",e,function(e){k.disableLoading(),0==e.code?(C.layer.msg("页面模板生成成功"),C.layer.close(t)):C.layer.msg(e.data,{time:1e4})},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})},cancel:function(e){C.layer.close(e)}});var e=w("#pageLanguageId").val(),t=w("#siteCode").val();k.postAjax("/activity/page-tpl/get-snapshot",{site_code:t,action:"home",id:e},function(e){k.disableLoading(),k.disableLayuiLoading(),0===e.code&&(w(".preview-img img").attr("src",e.data).css({width:"180px",height:"auto"}),w("input[name=model_pic]").val(e.data))},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message),k.disableLoading()})}),w("#generate_site_page").click(function(){C.layer.open({title:"请选择要发布的渠道页面",btn:["取消","确定"],skin:"gb_sync_class zf_sync_activity_class",type:"1",area:"720px",btnAlign:"c",content:w("#page_pipleline_generate_template").html(),success:function(){C.form.render()},btn2:function(e){var t=[],a=w("#pageId").val();if(0==w('[name="generate_pipeline_site"]:checked').length)return C.layer.msg("请选择需要发布的渠道"),!1;w('[name="generate_pipeline_site"]:checked').each(function(){t.push({pipeline:w(this).val().split("_")[0],lang:w(this).val().split("_")[1]})}),k.postAjax("/activity/zf/design/batch-release",{page_id:a,batch_data:JSON.stringify(t)},function(e){C.layer.msg(e.message),k.disableLoading()},function(e){C.layer.msg(e.message),k.disableLoading()})}}),w("#page_channel_form").on("click",".layui-form-checkbox",function(){var e=w(this).prev("input[name=generate_pipeline_site]"),t=w("#groupId").val(),a=w("#pageId").val();pipeline=e.attr("data-pipeline");var i={page_id:a,group_id:t,pipeline:pipeline};e.prop("checked")&&(k.enableLoading(),w.ajax({type:"get",url:"/activity/zf/design/preload-release",data:i,dataType:"json",success:function(e){k.disableLoading()},error:function(e){C.layer.msg(e.message),k.disableLoading()}}))})}),w("#advertisement_generate_page").click(function(){C.layer.confirm("确认生成该页面？",{btn:["取消","确定"],area:"420px",skin:"element-ui-dialog-class",icon:3,title:"提示"},function(e){C.layer.close(e)},function(t){w.post("/advertisement/design/release",{page_id:w("#pageId").val(),lang:w("#pageLang").val()},function(e){C.layer.msg(e.message),C.layer.close(t),0===e.code&&w("#page_link_template").html('<a href="'+e.data.current.url+'" target="_blank" class="layui-btn layui-btn-normal">'+e.data.current.name+"</a>")})})}),w("#preview_page").click(function(){window.open(w(this).data("href")),w(this).blur()}),w("#view_convert_page").change(function(){location.href=w(this).val()}),w("#sync_channel").click(function(){C.layer.open({title:"同步其他渠道信息",btn:["取消","确定"],skin:"gb_sync_class",type:"1",area:"720px",btnAlign:"c",content:w("#page_pipeline_sync_template").html(),success:function(){var l=w(".gb_sync_class");k.getAjax("/activity/zf/design/get-copy-pipeline",{page_id:w("#pageId").val(),lang:w("#pageLang").val()}).done(function(t){if(0==t.code){var a="",i=t.data.fromPipeline,n={};0<i.length&&(i.forEach(function(e){a+='<option value="'+e.pipeline+'">'+e.pipeline_name+"</option>",n[e.pipeline]=e}),w('[name="pipeline_selected"]').html(a));var o=function(e){var t=e?n[e].langList:0<i.length?i[0].langList:[],a="";t.forEach(function(e){a+='<option value="'+e.key+'">'+e.name+"</option>"}),l.find("[name=lang_list]").html(a),C.form.render("select"),w(".channel-container .swiper-wrapper li").on("click",function(){var e=w(this).index();w(this).addClass("layui-this").siblings().removeClass("layui-this"),w(".channel-container").find(".layui-tab-item:eq("+e+")").addClass("layui-show").siblings().removeClass("layui-show")})},s=function(e){var t=e||w('[name="pipeline_selected"]').val(),a=w('[name="lang_list"]').val();w(".layui-tab-item[data-channel1="+t+"] .input_check_all",l).prop("checked",!1),w(".layui-tab-item input",l).each(function(){var e=w(this);e.val()==t&&e.attr("data-value")==a?(e.prop("checked",!1),e.attr("disabled","disabled")):e.removeAttr("disabled")}),r()},r=function(){w(".layui-tab-item",l).each(function(e,t){var a=!1;a=!(w(t).find(".input_item").length>w(t).find(".input_item:checked").length),w(t).find(".input_check_all").prop("checked",a)})};!function(){if(0<t.data.toPipeline.length){var o="",s="";t.data.toPipeline.forEach(function(t,e){var a="",i="layui-tab-item";0===e&&(a="layui-this",i="layui-tab-item layui-show"),o+='<li class="swiper-slide '+a+'" data-key="'+t.pipeline+'" class='+a+">"+t.pipeline_name+"</li>";var n='<div class="'+i+'" data-channel1='+t.pipeline+" data-channel="+t.page_id+'><input type="checkbox" name="check_all_'+t.pipeline+'" class="input_check_all" lay-filter="check_all_'+t.pipeline+'" title="全选" lay-skin="primary">';t.langList.forEach(function(e){n+='<input type="checkbox" class="input_item" name="lang_'+e.key+"_"+t.pipeline+'" title="'+e.name+'" data-value="'+e.key+'" value="'+t.pipeline+'" lay-skin="primary" lay-filter="sync_checkone_'+t.pipeline+'">',1==e.is_default&&(n+='<span style="color: #999; margin-top: 10px; margin-left: -10px; margin-right: 10px; vertical-align: middle; display: inline-block;">(默认)</span>')}),s+=n+="</div>"}),w(".layui-tab-title",l).html(o),w(".layui-tab-content",l).html(s),w(".layui-tab-item",l).each(function(e,t){!function(n,e,o){C.form.on("checkbox("+n+")",function(e){var t=e.elem.checked||!1;w(o).not(":disabled").prop("checked",t),C.form.render("checkbox")}),C.form.on("checkbox("+e+")",function(e){for(var t=w(o),a=0;a<t.length;a++)if(0==t[a].checked){w("input[name="+n+"]").prop("checked",!1),C.form.render("checkbox");break}var i=t.length;for(a=0;a<t.length;a++)1==t[a].checked&&i--;0==i&&w("input[name="+n+"]").prop("checked",!0),C.form.render("checkbox")})}(w(t).find(".input_check_all").attr("lay-filter"),w(t).find(".input_item").attr("lay-filter"),w(".input_item",w(t)))}),w(".swiper-wrapper",l).html(o);var e=new Swiper(w(".channel-container",l),{slidesPerView:5,spaceBetween:10,slidesPerGroup:5,loopFillGroupWithBlank:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},nextButton:".swiper-button-next",prevButton:".swiper-button-prev"});w(".layui-tab-content .layui-tab-item",l).length<=5&&(e.navigation?(e.navigation.$nextEl.addClass("layui-hide"),e.navigation.$prevEl.addClass("layui-hide")):(e.nextButton.addClass("layui-hide"),e.prevButton.addClass("layui-hide")))}else C.layer.msg("不存在同步渠道")}(),o(),s(),C.form.render(),C.form.on("select(pipeline_selected)",function(e){var t=e.value;o(t),s(t),C.form.render("checkbox")}),C.form.on("select(lang_list)",function(e){s(),C.form.render("checkbox")})}})},btn2:function(t){var e=w(".gb_sync_class");if(!(0<w(".layui-tab-item input.input_item:checked").length&&w("[name=pipeline_selected]",e).val()&&w("[name=lang_list]",e).val()))return C.layer.msg("请选择必选内容"),!1;var a=[];w(".layui-tab-item input.input_item:checked").each(function(){a.push(w(this).val())});var i={pipeline:w('[name="pipeline_selected"]',e).val(),lang:w('[name="lang_list"]',e).val()},n=[];w(".layui-tab-item",e).each(function(e,t){var a=[];w(t).find(".input_item:checked").each(function(e,t){a.push(w(t).attr("data-value"))}),0<a.length&&n.push({pipeline:w(t).attr("data-channel1"),lang:a.toString()})}),k.postAjax("/activity/zf/design/copy-pipeline",{page_id:w("#pageId").val(),type:w('[name="pipeline_type"]:checked').val(),from:JSON.stringify(i),to:JSON.stringify(n)},function(e){0==e.code?(C.layer.msg("数据同步成功"),window.location.reload()):C.layer.msg(e.message),C.layer.close(t),k.disableLoading()},function(e){C.layer.msg(e.message),C.layer.close(t),k.disableLoading()})}})}),w("body").on("click",".redistribution",function(t){w.post("/activity/"+interface_code+"/design/release",{page_id:w("#pageId").val(),lang:w("#pageLang").val()},function(e){C.layer.msg(e.message),C.layer.close(t)})}),w("body").on("click",".adRedistribution",function(t){w.post("/advertisement/design/release",{page_id:w("#pageId").val(),lang:w("#pageLang").val()},function(e){C.layer.msg(e.message),C.layer.close(t)})}),w("#view_page").click(function(){function n(e){C.layer.open({title:"访问链接",btn:["取消","确认"],skin:"view-page-dialog-wrap view-page-pipelang-dialog",btnAlign:"c",area:"1000px",content:e})}w.get("/activity/zf/page/pipeline-newest-urls",{activity_id:w("#activityId").val(),group_id:w("#groupId").val()},function(e){if(k.disableLoading(),0==e.code){var a=[];if(void 0!==e.data.pipeline_list&&0<e.data.pipeline_list.length&&e.data.pipeline_list.forEach(function(t){t.lang_list.forEach(function(e){a.push({name:t.name+"——"+e.lang_name,url:e.page_url,is_default:e.is_default})})}),""!=a){var t="";if(w.each(a,function(){var e=this.name;1==this.is_default&&(e+='<span style="color: #fff">(默认)</span>'),t+='<a href="'+this.url+'" class="layui-btn layui-btn-normal view-link" target="_blank">'+e+"</a>"}),void 0!==e.data.tips){var i=e.data.tips;n(t+'<p style="margin-top:20px;"> '+i+" &nbsp;&nbsp; <button class='layui-btn layui-btn-normal redistribution'>重新发布</button></p>")}else n(t)}else n(e.data.tips+"&nbsp;&nbsp;<button class='layui-btn layui-btn-normal redistribution'>重新发布</button>")}else n("页面未发布成功，请&nbsp;&nbsp;<button class='layui-btn layui-btn-normal redistribution'>重新发布</button>")})}),w("#advertisement_view_page").click(function(){w.get("/advertisement/page/get-page-newest-urls",{id:w("#pageId").val()},function(e){if(k.disableLoading(),0==e.code){var t=[];if(0<e.data.list.length&&e.data.list.forEach(function(e){t.push({name:e.lang_name,url:e.page_url})}),""!=t){var a="";if(w.each(t,function(){a+='<a href="'+this.url+'" class="layui-btn layui-btn-normal" target="_blank">'+this.name+"</a>"}),""!=e.data.tips){var i=e.data.tips;C.layer.open({title:"访问链接",btn:["取消","确认"],btnAlign:"c",area:"640px",content:a+'<p style="margin-top:20px;"> '+i+" &nbsp;&nbsp; <button class='layui-btn layui-btn-normal adRedistribution'>重新发布</button></p>"})}else C.layer.open({title:"访问链接",btn:["取消","确认"],btnAlign:"c",area:"640px",content:a})}else C.layer.open({title:"访问链接",btn:["取消","确认"],btnAlign:"c",area:"640px",content:e.data.tips+"&nbsp;&nbsp;<button class='layui-btn layui-btn-normal adRedistribution'>重新发布</button>"})}else C.layer.open({title:"访问链接",btn:["取消","确认"],btnAlign:"c",area:"640px",content:"页面未发布成功，请&nbsp;&nbsp;<button class='layui-btn layui-btn-normal adRedistribution'>重新发布</button>"})})}),w("#advertisement_generate_page").click(function(){C.layer.confirm("确认生成该页面？",{btn:["取消","确定"],area:"420px",skin:"element-ui-dialog-class",icon:3,title:"提示"},function(e){C.layer.close(e)},function(t){w.post("/advertisement/design/release",{page_id:w("#pageId").val(),lang:w("#pageLang").val()},function(e){C.layer.msg(e.message),C.layer.close(t),0===e.code&&w("#page_link_template").html('<a href="'+e.data.current.url+'" target="_blank" class="layui-btn layui-btn-normal">'+e.data.current.name+"</a>")})})}),w("#view_to_design").click(function(){w(this).addClass("layui-btn-normal").removeClass("layui-btn-primary"),w("#design_to_view").removeClass("layui-btn-normal").addClass("layui-btn-primary"),w(".design-preview-hidden").removeClass("design-preview-hidden"),w(".geshop-component-box").each(function(){w(this).removeClass("design-preview-box"),w(this).find(".design-preview-content").remove()})}),w("#design_to_view").click(function(){w(this).addClass("layui-btn-normal").removeClass("layui-btn-primary"),w("#view_to_design").removeClass("layui-btn-normal").addClass("layui-btn-primary"),k.renderViewPage()}),C.use("form",function(){var e=C.form;e.on("switch(switchInput)",function(e){e.elem.checked?w("#design_to_view",o).trigger("click"):w("#view_to_design",o).trigger("click")}),e.on("select(selectLang)",function(e){window.location.href=e.value}),C.element.on("tab(tab_channel_lang)",function(e){var t=w(e.elem);t.find(".layui-tab-title").addClass("layui-tab-more_gb"),setTimeout(function(){t.find(".layui-tab-title").addClass("layui-tab-more").removeClass("layui-tab-more_gb"),t.find(".layui-tab-bar").attr("title","收缩")},100)}),C.form.on("radio(system-custom-settings)",function(e){1==e.value?(w(this).parents(".page-style-select-container").nextAll(".page-system-settings-container").show(),w(this).parents(".page-style-select-container").nextAll(".page-custom-settings-container").hide()):2==e.value&&(w(this).parents(".page-style-select-container").nextAll(".page-custom-settings-container").show(),w(this).parents(".page-style-select-container").nextAll(".page-system-settings-container").hide())})});var t=C.element;w("body").on("blur",".page-stylesheet-list-container .class-name",function(){if(w(this).val().trim()){var e=w(this).parents(".layui-tab-item").index();w(".page_style_option_bar .layui-tab-title li:eq("+e+")").text(w(this).val()),C.element.render("tab")}}),w("body").on("click",".page-position-repeat .page-background-position",function(){w(this).addClass("current").siblings().removeClass("current")}),w("body").on("click","#js_addTab",function(){if(7<=w(".page_style_option_bar .layui-tab-title li").length)return C.layer.msg("最多只能添加6个自定义样式，别贪心哟",{time:5e3}),!1;var e='<div class="layui-form-item"><div class="layui-input-block layui-form-title">样式名称</div><div class="layui-input-block"><input type="text" class="layui-input class-name" style="width:406px" name="" autocomplete="off" value="页面样式'+ ++s+'"></div></div><div class="layui-form-item" style="margin-top: 8px;"><div class="layui-input-block layui-form-title">时间设置</div><div class="layui-input-block" style="position:relative;width:406px"><span class="time-icon"></span><input type="text" class="layui-input start-time js_start_time" style="display:inline;width:203px;border-right:none;" name="" placeholder="开始时间" autocomplete="off" value=""><span class="time-split">至</span><input type="text" class="layui-input end-time js_end_time" style="display:inline;width:203px;border-left:none;margin-left:-1px" placeholder="结束时间" name="" autocomplete="off" value=""><span class="time-settings-tips">（注:时间段不要与其他页面样式出现交集哦）</span></div></div><div class="layui-form-item page-style-select-container" style="margin-top: 8px;"><div class="layui-input-block layui-form-title">页面样式选择<span style="margin-left:10px;color:#9E9E9E;font-size:12px;">（注：当无任何切换的时间段时，页面样式按照通用样式设置进行展示）</span></div><div class="layui-input-block"><input type="radio" name="page_style_select_'+s+'" lay-filter="system-custom-settings" value="1" title="系统设置" checked><input type="radio" name="page_style_select_'+s+'" lay-filter="system-custom-settings" value="2" title="自定义设置"></div></div><div class="page-system-settings-container" style="margin-top: -4px;"><div class="layui-form-item"><div class="layui-input-block layui-form-title">整体页面背景颜色</div><div class="layui-input-block"><div class="color-picker-selector" data-hidden-name="page_background_color"><div></div></div><input type="text" class="layui-input background-color" style="width:406px" name="page_background_color" autocomplete="off" value=""></div></div><div class="layui-form-item" style="margin-top: 4px;"><div class="layui-input-block layui-form-title">整体页面背景图片</div><div class="layui-input-block"><a href="javascript:;" class="js_openResource design-open-resource" data-type="tabBgImg"><i class="layui-icon">&#xe64a;</i></a><input type="text" name="page_background_image" style="width:406px" autocomplete="off" class="layui-input background-image" value=""></div></div><div class="layui-form-item page-background-repeat" style="margin-top: 8px;"><div class="layui-input-block layui-form-title">平铺方式</div><div class="layui-input-block"><input type="radio" name="page_background_repeat_'+s+'" value="no-repeat" title="不平铺"><input type="radio" name="page_background_repeat_'+s+'" value="repeat" title="平铺" checked><input type="radio" name="page_background_repeat_'+s+'" value="repeat-x" title="横向平铺"><input type="radio" name="page_background_repeat_'+s+'" value="repeat-y" title="纵向平铺"></div></div><div class="layui-form-item page-position-repeat" style="margin-top: -4px;"><div class="layui-input-block layui-form-title">对齐方式</div><div class="layui-input-block"><a href="javascript:;" class="page-background-position" data-value="top"></a><a href="javascript:;" class="page-background-position" data-value="right"></a><a href="javascript:;" class="page-background-position" data-value="bottom"></a><a href="javascript:;" class="page-background-position" data-value="left"></a><a href="javascript:;" class="page-background-position current" data-value="center"></a><a href="javascript:;" class="page-background-position" data-value="top left"></a><a href="javascript:;" class="page-background-position" data-value="top right"></a><a href="javascript:;" class="page-background-position" data-value="buttom left"></a><a href="javascript:;" class="page-background-position" data-value="bottom right"></a></div></div></div><div class="page-custom-settings-container"><div class="layui-form-item custom-settings-stylesheet">\x3c!-- <label class="layui-form-label">页面样式</label> --\x3e<div class="layui-input-block layui-form-title">页面样式</div><div class="layui-input-block"><textarea name="page_custom_css" style="width:800px" placeholder="请输入样式代码" class="layui-textarea"></textarea></div></div></div>';t.tabAdd("page-stylesheet-settings-bar",{title:"页面样式"+s,content:e,id:s}),w(this).insertAfter(w(".page_style_option_bar .layui-tab-title li:last-child")),C.form.render("radio"),k.renderDatetime(),k.renderColorPicker()}),w("#design_view").on("mouseenter",k.toClassName("lDrag"),function(){if(w("#switch_preview").prop("checked"))return!1;0===w(this).find(".design-operation-panel").length&&(w(this).append(w("#layout_operation_template").html()),sessionStorage.getItem("copiedLayoutId")?w(".js_pasteInLayout").show():w(".js_pasteInLayout").hide(),0<w(this).find(k.toClassName("cDrag")).length||!sessionStorage.getItem("copiedComponentId")?w(".js_pasteInEmptyLayout").hide():w(".js_pasteInEmptyLayout").show(),w("#js_layoutName").text(w("#design_drag [data-key="+w(this).data("key")+"]").data("name")))}),w("#design_view").on("mouseleave",k.toClassName("lDrag"),function(){w(this).find(".design-operation-panel").remove(),w(k.toClassName("cDrop")+", "+k.toClassName("cDrag")).css({overflow:"hidden"})}),w("#design_view").on("mouseenter",k.toClassName("cDrag"),function(){if(w("#switch_preview").prop("checked"))return!1;var e=w(this),t=Boolean(e.data("unique"));0===e.find(".design-operation-panel").length&&(e.append(w("#component_operation_template").html()),e.css({overflow:"auto"}),e.parent(k.toClassName("cDrop")).css({overflow:"auto"}),t&&e.find(".geshop-draggable, .js_sortUpComponent, .js_sortDownComponent, .js_copyComponent, .js_pasteInComponent").remove(),sessionStorage.getItem("copiedComponentId")?w(".js_pasteInComponent").show():w(".js_pasteInComponent").hide(),w("#js_componentName").text(w("#design_drag [data-key="+e.data("key")+"]").data("name")));var a=e.closest(k.toClassName("lDrag"));0===a.find("> .design-operation-panel").length&&(a.append(w("#layout_operation_template").html()),t&&a.find(".js_copyLayout, .js_pasteInEmptyLayout, .js_pasteInLayout").remove(),sessionStorage.getItem("copiedLayoutId")?w(".js_pasteInLayout").show():w(".js_pasteInLayout").hide(),w(".js_pasteInEmptyLayout").hide(),w("#js_layoutName").text(w("#design_drag [data-key="+a.data("key")+"]").data("name")))}),w("#design_view").on("mouseleave",k.toClassName("cDrag"),function(){w(this).find(".design-operation-panel").remove(),w(k.toClassName("cDrop")+", "+k.toClassName("cDrag")).css({overflow:"hidden"})}),w("#design_view").on("click",".js_openLayoutForm",function(){var i=w(this).closest(k.toClassName("lDrag")).attr("id");k.enableLoading(),k.componentFormShow(),w.get("/activity/"+interface_code+"/layout-design/get-layout-form",{page_id:w("#pageId").val(),id:i},function(e){if(k.disableLoading(),0===e.code){0<w(".design-form-layout").find(".geshop-form-content").length&&w(".design-form-layout").find(".geshop-form-content").remove();var a=[],t=0;a.push('<div class="geshop-form-content">'),a.push(e.data.component_html),a.push("</div>"),w(".design-form-layout").hasClass("design-form-visible")&&(w(".design-form-layout").removeClass("design-form-visible"),t=300),setTimeout(function(){w(window.parent.document).find("#layout_form").prepend(a.join("")),w(window.parent.document).find(".design-form-layout").addClass("design-form-visible");var e=C.form,t=C.element;e.render(),t.render(),window.parent.window.Design.renderColorPicker(),sessionStorage.setItem("currentLayoutId",i)},t)}else C.layer.msg(e.message)})}).on("click",".js_openComponentForm",function(){var e=w(this).closest(k.toClassName("cDrag")).data("id");sessionStorage.setItem("currentTemplateId",""),window.parent.window.Design.openComponentForm(e,!0,!0),sessionStorage.setItem("currentComponentId",e)}).on("click",".js_addLayout",function(){var e=w(this).closest(k.toClassName("lDrag")),t=0<e.prev(k.toClassName("lDrag")).length?e.prev(k.toClassName("lDrag")).attr("id"):0;k.openCustomLayoutDialog(e,t,!1),k.renderLayoutTitle()}).on("click",".js_removeLayout",function(){var n=w(this).closest(k.toClassName("lDrag"));C.layer.confirm("确定删除该布局？",{btn:["取消","确认"],area:"420px",icon:3,skin:"element-ui-dialog-class"},function(e){C.layer.close(e)},function(a){var e="/activity/"+interface_code+"/layout-design/delete-layout",i=n.attr("id"),t={page_id:w("#pageId").val(),id:i,lang:w("#pageLang").val()};k.postAjax(e,t,function(e){if(k.disableLoading(),0===e.code){n.remove(),i==sessionStorage.getItem("currentLayoutId")&&w("#js_closeDesignForm").trigger("click"),i==sessionStorage.getItem("copiedLayoutId")&&sessionStorage.setItem("copiedLayoutId","");var t=n.find(k.toClassName("cDrag"));0<t.length&&t.each(function(){w(this).data("id")==sessionStorage.getItem("copiedComponentId")&&sessionStorage.setItem("copiedComponentId","")}),C.layer.close(a)}C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})})}).on("click",".js_sortUpLayout",function(){var t=w(this).closest(k.toClassName("lDrag"));if(t.prevAll(k.toClassName("lDrag")).length<=0)return C.layer.msg("布局已在最前面，无需移动！"),!1;var e="/activity/"+interface_code+"/layout-design/move-layout",a={page_id:w("#pageId").val(),id:t.attr("id"),prev_id:1<t.prevAll(k.toClassName("lDrag")).length?t.prevAll(k.toClassName("lDrag")).get(1).id:0,lang:w("#pageLang").val()};k.postAjax(e,a,function(e){k.disableLoading(),0===e.code?(w(t.prevAll(k.toClassName("lDrag")).get(0)).before(t.get(0).outerHTML),t.remove()):C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})}).on("click",".js_sortDownLayout",function(){var t=w(this).closest(k.toClassName("lDrag"));if(t.nextAll(k.toClassName("lDrag")).length<=0)return C.layer.msg("布局已在最后面，无需移动！"),!1;var e="/activity/"+interface_code+"/layout-design/move-layout",a={page_id:w("#pageId").val(),id:t.attr("id"),prev_id:0<t.nextAll(k.toClassName("lDrag")).length?t.nextAll(k.toClassName("lDrag")).get(0).id:0,lang:w("#pageLang").val()};k.postAjax(e,a,function(e){k.disableLoading(),0===e.code?(w(t.nextAll(k.toClassName("lDrag")).get(0)).after(t.get(0).outerHTML),t.remove()):C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})}).on("click",".js_removeComponent",function(){var n=w(this).closest(k.toClassName("cDrag"));C.layer.confirm("确认删除该组件？",{btn:["取消","确认"],area:"420px",icon:3,skin:"element-ui-dialog-class"},function(e){C.layer.close(e)},function(t){var e="/activity/"+interface_code+"/ui-design/delete-ui",a=n.data("id"),i={page_id:w("#pageId").val(),id:a,lang:w("#pageLang").val()};k.postAjax(e,i,function(e){k.disableLoading(),0===e.code&&(n.remove(),a==sessionStorage.getItem("copiedComponentId")&&sessionStorage.setItem("copiedComponentId",""),a==sessionStorage.getItem("currentComponentId")&&w("#js_closeDesignForm").trigger("click"),C.layer.close(t)),C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})})}).on("click",".js_copyComponent",function(){var e=w(this).closest(k.toClassName("cDrag")).data("id");sessionStorage.setItem("copiedComponentId",e),C.layer.msg("组件已复制！")}).on("click",".js_copyLayout",function(){var e=w(this).closest(k.toClassName("lDrag")).attr("id");sessionStorage.setItem("copiedLayoutId",e),C.layer.msg("布局已复制！")}).on("click",".js_pasteInEmptyLayout",function(){var t=w(this).closest(k.toClassName("lDrag")),e="/activity/"+interface_code+"/ui-design/copy-ui",a={page_id:w("#pageId").val(),layout_id:w(this).closest(k.toClassName("lDrag")).attr("id"),position:1,lang:w("#pageLang").val(),copy_id:sessionStorage.getItem("copiedComponentId"),prev_id:0,num:1};k.postAjax(e,a,function(e){k.disableLoading(),0===e.code?(t.find("[data-position=1] "+k.toClassName("cDrop")).html(e.data.component_html),k.renderViewPage(),C.layer.msg("组件已粘贴！")):C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})}).on("click",".js_pasteInLayout",function(){var i=w(this).closest(k.toClassName("lDrag"));C.layer.confirm("请输入复制份数",{content:w("#copy_layout_template").html(),btn:["取消","确定"]},function(e){C.layer.close(e)},function(){var e=w("#copyNum").val(),t="/activity/"+interface_code+"/layout-design/copy-layout",a={page_id:w("#pageId").val(),lang:w("#pageLang").val(),copy_id:sessionStorage.getItem("copiedLayoutId"),prev_id:i.attr("id"),num:e};k.postAjax(t,a,function(e){k.disableLoading(),0===e.code?(i.after(e.data.component_html),k.renderViewPage(),k.renderLayoutTitle(),C.layer.msg("布局已粘贴！")):C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})})}).on("click",".js_pasteInComponent",function(){var i=w(this).closest(k.toClassName("cDrag")),n=w(this).closest(k.toClassName("lDrag")).attr("id"),o=w(this).closest("[data-position]").data("position");C.layer.confirm("请输入复制份数",{content:w("#copy_layout_template").html(),btn:["取消","确定"]},function(e){C.layer.close(e)},function(){var e=w("#copyNum").val(),t="/activity/"+interface_code+"/ui-design/copy-ui",a={page_id:w("#pageId").val(),layout_id:n,position:o,lang:w("#pageLang").val(),copy_id:sessionStorage.getItem("copiedComponentId"),num:e,prev_id:i.data("id")};k.postAjax(t,a,function(e){if(k.disableLoading(),0===e.code){var t=sessionStorage.getItem("copiedComponentId");e.data.uiIds.forEach(function(e){window.GESHOP_ASYNC_DATA_INFO[e]=JSON.parse(JSON.stringify(window.GESHOP_ASYNC_DATA_INFO[t]||[])),window.postMessage&&window.postMessage({data:window.GESHOP_ASYNC_DATA_INFO,message_type:"dresslily_update_goods_info"},window.location.origin)}),i.after(e.data.component_html),k.renderViewPage(),C.layer.msg("组件已粘贴！")}else C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})})}).on("click",".js_sortUpComponent",function(){var t=w(this).closest(k.toClassName("cDrag"));if(t.prevAll(k.toClassName("cDrag")).length<=0)return C.layer.msg("组件已在最前面，无需移动！"),!1;var e="/activity/"+interface_code+"/ui-design/move-ui",a={page_id:w("#pageId").val(),id:t.data("id"),prev_id:1<t.prevAll(k.toClassName("cDrag")).length?t.prevAll(k.toClassName("cDrag")).get(1).getAttribute("data-id"):0,layout_id:t.closest(k.toClassName("lDrag")).attr("id"),position:t.closest("[data-position]").data("position"),lang:w("#pageLang").val()};k.postAjax(e,a,function(e){k.disableLoading(),0===e.code?(w(t.prevAll(k.toClassName("cDrag")).get(0)).before(t.get(0).outerHTML),t.remove()):C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})}).on("click",".js_sortDownComponent",function(){var t=w(this).closest(k.toClassName("cDrag"));if(t.nextAll(k.toClassName("cDrag")).length<=0)return C.layer.msg("组件已在最后面，无需移动！"),!1;var e="/activity/"+interface_code+"/ui-design/move-ui",a={page_id:w("#pageId").val(),id:t.data("id"),prev_id:0<t.nextAll(k.toClassName("cDrag")).length?t.nextAll(k.toClassName("cDrag")).get(0).getAttribute("data-id"):0,layout_id:t.closest(k.toClassName("lDrag")).attr("id"),position:t.closest("[data-position]").data("position"),lang:w("#pageLang").val()};k.postAjax(e,a,function(e){k.disableLoading(),0===e.code?(w(t.nextAll(k.toClassName("cDrag")).get(0)).after(t.get(0).outerHTML),t.remove()):C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})}).on("mouseenter",".component-drag",function(){w(this).append('<a href="javascript:;" class="component-drag-mask js_maskOpenComponentForm"></a>')}).on("mouseleave",".component-drag-mask",function(){w(".component-drag-mask").remove()}).on("click",".js_maskOpenComponentForm",function(){var e=w(this).closest(k.toClassName("cDrag")).data("id");e==sessionStorage.getItem("currentComponentId")&&w(".design-form-component").hasClass("design-form-visible")?w(".design-form-component").removeClass("design-form-visible"):(sessionStorage.setItem("currentTemplateId",""),window.parent.window.Design.openComponentForm(e,!0),sessionStorage.setItem("currentComponentId",e))}).on("click",".js_saveComponentTemp",function(){var i=w(this).closest(k.toClassName("cDrag")).data("id"),e=w("#design_view").width(),t=385===w("#design_view").width()||375===w("#design_view").width()||375<=e&&e<=768;return C.layer.open({title:"新增组件模板",btn:["取消","确认"],type:"1",area:t?"320px":"720px",btnAlign:"c",content:w("#component_model_template").html(),success:function(){C.form.render(),C.upload.render({elem:"#upload_model_picture",field:"files",url:"/activity/"+interface_code+"/page-tpl/upload-pic",accept:"images",exts:"jpg|png|gif|bmp|jpeg|wepb",size:3072,before:function(){k.enableLayuiLoading()},done:function(e){if(k.disableLayuiLoading(),0===e.code){var t=e.data.url;w("#upload_model_resource").html("上传成功，"+t),w("[name=model_pic]").val(t)}else C.layer.msg(e.message)},error:function(){k.disableLayuiLoading(),C.layer.msg("接口错误！")}})},yes:function(e){C.layer.close(e)},btn2:function(t){var e="/activity/"+interface_code+"/page-ui-tpl/add",a={page_id:w("#pageId").val(),ui_id:i,name:w("[name=cmp_model_name]").val(),pic_url:w("[name=model_pic]").val(),view_type:w("select[name=model_type]").val()};if(""==a.name)return C.layer.msg("模板名称不能为空"),!1;if(50<a.name.length)return C.layer.msg("名称不能超过50个字符"),!1;return k.postAjax(e,a,function(e){k.disableLoading(),0==e.code?(C.layer.msg("组件模板生成成功"),C.layer.close(t)):C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)}),!1},cancel:function(e){C.layer.close(e)}}),!1}),w(".design-form").on("submit","#layout_form",function(e){e.preventDefault()}).on("submit","#component_form",function(e){e.preventDefault()}).on("click",".js_closeDesignForm",function(){w(".design-form").removeClass("design-form-visible"),w(".design-form").find(".geshop-form-content").remove(),sessionStorage.removeItem("imgHeight"),sessionStorage.removeItem("imgWidth"),k.componentFormHide()}).on("click","#layout_form .js_submitDesignForm",function(){sessionStorage.removeItem("imgHeight"),sessionStorage.removeItem("imgWidth");var e="/activity/"+interface_code+"/layout-design/save-layout-form",a={page_id:w("#pageId").val(),id:sessionStorage.getItem("currentLayoutId")};w(".design-form").find("input").each(function(e,t){a[t.name]=t.value});k.postAjax(e,a,function(e){if(k.disableLoading(),0===e.code){var t=w(k.toClassName("lDrag")+"[id="+sessionStorage.getItem("currentLayoutId")+"]",o);t.after(e.data.component_html),t.remove(),w(".js_closeDesignForm").trigger("click")}C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})}).on("click","#component_form .js_submitDesignForm",function(){var e="/activity/"+interface_code+"/ui-design/save-form",t={page_id:w("#pageId").val(),id:sessionStorage.getItem("currentComponentId"),lang:w("#pageLang").val(),goodsInfoArr:sessionStorage.currentGoodsInfo},a=k.getComponentFormData();t.tpl_id=a.tpl_id,t.tpl_id!=sessionStorage.getItem("currentTemplateId")?t.private_data="{}":t.private_data=JSON.stringify(a.private),t.public_data=JSON.stringify(a.public),k.postAjax(e,t,function(e){if(k.disableLoading(),0===e.code){GESHOP_STORE.dispatch("global/deleteCurrentGoodsInfo");var t=e.data.async_data_info?e.data.async_data_info:[];window.GESHOP_ASYNC_DATA_INFO=Object.assign({},window.GESHOP_ASYNC_DATA_INFO),window.GESHOP_ASYNC_DATA_INFO[sessionStorage.getItem("currentComponentId")]=t;var a=document.getElementById("design_view_iframe").contentWindow;a.postMessage&&a.postMessage({data:window.GESHOP_ASYNC_DATA_INFO,message_type:"dresslily_update_goods_info"},window.location.origin);var i=w(k.toClassName("cDrag")+"[data-id="+sessionStorage.getItem("currentComponentId")+"]",o),n=!1;i.after(e.data.component_html),i.remove(),e.data.tpl_id!=sessionStorage.getItem("currentTemplateId")&&(n=!0),k.openComponentForm(sessionStorage.getItem("currentComponentId"),n,!1),w(".js_closeDesignForm").trigger("click")}C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})}),w("#component_form_dialog").click(function(){w(".js_closeDesignForm").trigger("click")}),w(".design-view").on("mouseenter",".design-operation-panel>a",function(){w(this).children("span").show()}),w(".design-view").on("mouseleave",".design-operation-panel>a",function(){w(this).children("span").hide()}),w(document).on("click",".js_openResource",function(){"tabBgImg"===w(this).data("type")&&(sessionStorage.setItem("currentTabContentIndex",w(this).parents(".layui-tab-item").index()),sessionStorage.setItem("currentTabContentType","tabBgImg")),sessionStorage.setItem("currentResourceId",0),resourceTree=[],sessionStorage.setItem("currentInputTargetName",w(this).next("input").attr("name")),C.layer.open({maxmin:!0,type:1,title:"素材管理器",area:["920px","600px"],content:w("#resource_view_template").html(),success:function(e,t){k.initializeResourceDialog(t)},cancel:function(){sessionStorage.setItem("currentResourceId",0)}})}),w("body").on("click",".js_useResource",function(){var e,t,a=sessionStorage.getItem("currentTabContentType"),i=sessionStorage.getItem("currentTabContentIndex"),n=sessionStorage.getItem("imgHeight"),o=sessionStorage.getItem("imgWidth"),s=w(this).data("height"),r=w(this).data("width"),l=!(!n||!o),d=parseInt(n)==s&&parseInt(o)==r;if("tabBgImg"==a)e=w(".page-stylesheet-list-container .layui-tab-item:eq("+i+")").find("input[name="+sessionStorage.getItem("currentInputTargetName")+"]").val(w(this).data("url")),sessionStorage.removeItem("currentTabContentType"),sessionStorage.removeItem("currentTabContentIndex"),w(".page-stylesheet-list-container .layui-tab-item:eq("+i+")").find(".page-background-repeat").show(),w(".page-stylesheet-list-container .layui-tab-item:eq("+i+")").find(".page-position-repeat").show();else{if(l&&!d)return C.layer.msg("请选择合适大小的图片！"),!1;e=w("[name="+sessionStorage.getItem("currentInputTargetName")+"]"),t=w(this).closest(".layui-layer-page").attr("times"),0<w("[name="+e.data("width")+"]").length&&w("[name="+e.data("width")+"]").val(w(this).data("width")),0<w("[name="+e.data("height")+"]").length&&w("[name="+e.data("height")+"]").val(w(this).data("height")),sessionStorage.removeItem("imgHeight"),sessionStorage.removeItem("imgWidth"),C.layer.close(t)}if(e.data("validWidth")&&w("[name="+e.data("validWidth")+"]").val()!=w(this).data("width")||e.data("validHeight")&&w("[name="+e.data("validHeight")+"]").val()!=w(this).data("height"))return C.layer.msg("请选择合适大小的图片！"),!1;e.val(w(this).data("url")),0<w("[name="+e.data("width")+"]").length&&w("[name="+e.data("width")+"]").val(w(this).data("width")),0<w("[name="+e.data("height")+"]").length&&w("[name="+e.data("height")+"]").val(w(this).data("height")),C.layer.close(t)}).on("click","#create_resource_folder",function(){w("#resource_folder_box").show()}).on("change","#resource_folder_input",function(){var e=w(this);if(w.trim(e.val()).length<=0)return C.layer.msg("请输入文件夹名称！"),!1;k.enableLoading();var t={name:e.val(),type:0,url:"",parent_id:sessionStorage.getItem("currentResourceId")||0};k.postAjax("/admin/resource/add",t,function(e){k.disableLoading(),0===e.code?(w("#resource_folder_input").val(""),w("#resource_folder_box").hide(),resourceTree.push({id:e.data.id,parent:0==e.data.parent_id?"#":e.data.parent_id,text:e.data.name}),k.renderResourceTree(),k.renderResourceExploere(sessionStorage.getItem("currentResourceId")||0,"/admin/resource/list")):C.layer.msg(e.message)},function(e){k.disableLoading(),k.disableLayuiLoading(),C.layer.msg(e.message)})}).on("click","#upload_resource_replace",function(){sessionStorage.getItem("currentResourceId")&&0!=Number(sessionStorage.getItem("currentResourceId"))?w("#upload_resource").trigger("click"):w("#empty_tip").show()}).on("click","#switch_to_tabletop",function(){w("#design_view").stop().animate({width:1378},500),window.sessionStorage.setItem("gs_platform","pc"),w(this).addClass("layui-btn-normal").removeClass("layui-btn-primary"),w(this).siblings().removeClass("layui-btn-normal").addClass("layui-btn-primary")}).on("click","#switch_to_tablet",function(){w("#design_view").stop().animate({width:972},500),window.sessionStorage.setItem("gs_platform","pad"),w(this).addClass("layui-btn-normal").removeClass("layui-btn-primary"),w(this).siblings().removeClass("layui-btn-normal").addClass("layui-btn-primary")}).on("click","#switch_to_mobile",function(){w("#design_view").stop().animate({width:409},500),window.sessionStorage.setItem("gs_platform","wap"),w(this).addClass("layui-btn-normal").removeClass("layui-btn-primary"),w(this).siblings().removeClass("layui-btn-normal").addClass("layui-btn-primary")}),document.addEventListener("dragstart",function(e){if(e.dataTransfer.setData("text/plain","for firefox"),"string"==typeof e.target.getAttribute("data-key")){var t=e.target.cloneNode(!0);t.style.backgroundColor="#FFFFFF",t.style.boxShadow="0px 0px 10px 0px rgba(155,155,155,0.5)",t.firstElementChild.style.color="#000",t.style.width="128px";var a="cTmp"===e.target.getAttribute("data-ctype")?"148px":"80px";t.style.height=a,t.style.padding="10px",t.style.boxSizing="border-box",t.style.position="absolute",t.style.top="-200px",t.style.zIndex="-100",document.body.appendChild(t);var i="cTmp"===e.target.getAttribute("data-ctype")?74:40;e.dataTransfer.setDragImage(t,64,i)}else{var n=new Image;n.src="/resources/images/drag-image.png",e.dataTransfer.setDragImage(n,60,45)}if(e.target.hasAttribute("data-type")){var o=e.target.getAttribute("data-type");"layout"===o?k.set("gTarget",w(e.target).closest(k.toClassName("lDrag")).get(0)):"component"===o&&k.set("gTarget",w(e.target).closest(k.toClassName("cDrag")).get(0))}else k.set("gTarget",e.target)},!1),document.addEventListener("drag",function(){},!1),document.addEventListener("dragend",function(e){"none"==e.dataTransfer.dropEffect&&(k.removeTip(),k.hideDropTip())},!1),document.addEventListener("dragenter",function(){},!1);var l=w("#component_layout_add_position_tips").clone(),d={};function e(e){e.preventDefault(),e.stopPropagation();var t,a,i,n=r.lastMousePageY;if(r.lastMousePageY=parseInt(e.pageY),w("#component_layout_add_position_tips",k.documentObject)&&n===e.pageY||r.dragStatus||!n&&Math.abs(n-e.pageY)<=200)return!1;if(r.dragStatus=1,setTimeout(function(){r.dragStatus=0},50),"component_layout_add_position_tips"===w(e.target).attr("id")&&w(".geshop-drop-tip-center-right").hide(),d.y=e.pageY,w(e.target).closest(".design-view").length<=0)return k.removeTip(),k.hideDropTip(),!1;if(-1!==k.get("gTarget").className.indexOf(k.get("lDrag"))){if(0<w(e.target).closest(k.toClassName("lDrag")).length){var o=(i=w(e.target).closest(k.toClassName("lDrag"))).offset().top+.5*i.outerHeight();d.y<=o?(l.text("释放之后，此布局将增加在此").show().insertBefore(i),sessionStorage.layout_position=0):(l.text("释放之后，此布局将增加在此").show().insertAfter(i),sessionStorage.layout_position=1),t="",a="right",k.removeBackGroundColor()}else if(0<w(e.target).closest(k.toClassName("lDrop")).length){if(0<(i=w(e.target).closest(k.toClassName("lDrop"))).find(k.toClassName("lDrag")).length)0==l.next(".geshop-layout-box").length&&l.text("释放之后，此布局将增加在此").show().insertAfter(i.find(".geshop-layout-box").last()),t="",k.removeBackGroundColor();else sessionStorage.layout_position=2,t="释放之后，新布局将添加到此页面",k.addBackGroundColor();a="right"}else i=w(e.target),t="此位置不能存放新布局",a="wrong";k.showDropTip(t,i,a)}else if(-1!==k.get("gTarget").className.indexOf(k.get("cDrag"))){if(0<w(e.target).closest(k.toClassName("cDrag")).length){var s=(i=w(e.target).closest(k.toClassName("cDrag"))).offset().top+.5*i.outerHeight();d.y<=s?(l.text("释放之后，此组件将增加在此").show().insertBefore(i),sessionStorage.position=0):(l.text("释放之后，此组件将增加在此").show().insertAfter(i),sessionStorage.position=1),t="",a="right",k.removeBackGroundColor()}else 0<w(e.target).closest(k.toClassName("cDrop")).length?(0<(i=w(e.target).closest(k.toClassName("cDrop"))).find(k.toClassName("cDrag")).length?(t="",k.removeBackGroundColor()):(sessionStorage.position=2,t="释放之后，新组件将添加到此布局",k.addBackGroundColor(),k.removeTip(),w(i).children(".design-preview-layout-title").css({opacity:0})),a="right"):(i=w(e.target),t="此位置不能存放新组件",a="wrong",w(i).find(".design-preview-layout-title").css({opacity:0}),k.removeTip());k.showDropTip(t,i,a)}e.preventDefault()}w("#design_view_iframe").on("load",function(){w("#design_view_iframe").css("height",w("#design_view").height()),o=w("#design_view_iframe").get(0).contentWindow.document,(k.documentObject=o).addEventListener("dragover",e,!1),o.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),o.addEventListener("drop",function(e){e.preventDefault();var t=null;-1!==k.get("gTarget").className.indexOf(k.get("lDrag"))?t=0<w(e.target).closest(k.toClassName("lDrag")).length?w(e.target).closest(k.toClassName("lDrag")).get(0):w(e.target).closest(k.toClassName("lDrop")).get(0):-1!==k.get("gTarget").className.indexOf(k.get("cDrag"))&&(t=0<w(e.target).closest(k.toClassName("cDrag")).length?w(e.target).closest(k.toClassName("cDrag")).get(0):w(e.target).closest(k.toClassName("cDrop")).get(0)),t=t||null,k.set("pTarget",t),k.drop(),k.hideDropTip(),k.layoutTitleOpacity()},!1)})})});