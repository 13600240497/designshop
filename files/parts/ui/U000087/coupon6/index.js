"use strict";$(function(){GEShopSiteCommon.appLogin();var c=[],s=[],a=[],n=GESHOP_STATIC;function t(n,e){for(var a=n.componentID,t=0;t<=s.length;t++)t==e&&(a=s[t].componentID);n.id;var o=$("#js_gs_coupon_template_"+a).html(),r=$("#js_gs_coupon_view_"+a),i=$('[data-id="'+a+'"]').attr("data-percent-link");function c(n,e){return 1==n?e+"%":'<span class="js-currency" data-currency="price">$price</span>'.replace("price",e).replace("price",e)}function u(n){return"app"===GESHOP_PLATFORM?"rosegal://action?actiontype=0":n}!function(n){if(n.category='<a href="'+n.category_url+'">'+n.category+"</a>",n.percent=function(n,e){return n<=-1?0:0==e?100:e<n?100:parseInt(n/e*100)}(n.leftCount,n.maxCount),n.validDays=function(n,e){return(e-n)/86400}(n.enableStartTime,n.enableEndTime),n.offerAmountString=c(n.type,n.offerAmount),n.thresholdAmountString=c(2,n.thresholdAmount),1<=n.receivedCount){var e="";0==n.resource&&(e=1===n.type?u(i):n.site_url),1==n.resource&&(e=n.category_url),2==n.resource&&(e=n.product_link),n.use_link=e}var t=gs_laytpl(o).render(n);r.html(t),window.GLOBAL&&window.GLOBAL.currency&&window.GLOBAL.currency.change_html(),window.FUN&&window.FUN.currency&&window.FUN.currency.change_html(),function(n,o){function s(n){for(var e=["is-countReady","is-countStart","is-countEnd"],t=0;t<e.length;t++)t===n?o.addClass(e[t]):o.removeClass(e[t])}1==n.limited?function(c,a,i){var u=setInterval(function(){var n=(new Date).getTime()/1e3,e=n<parseInt(c)?0:n<parseInt(a)?1:2;s(e);var t=0==e?parseInt(c):parseInt(a);if(!(e<2))return i.find(".countdown-number-hour").html("00"),i.find(".countdown-number-minute").html("00"),i.find(".countdown-number-second").html("00"),clearInterval(u);var o=t-n,r=function(n){var e=parseInt(n),t=0,o=0;60<e&&(t=parseInt(e/60),e=parseInt(e%60),60<t&&(o=parseInt(t/60),t=parseInt(t%60)));o<10&&(o="0"+o);t<10&&(t="0"+t);e<10&&(e="0"+e);return[o,t,e]}(o);return i.find(".countdown-number-hour").html(r[0]),i.find(".countdown-number-minute").html(r[1]),i.find(".countdown-number-second").html(r[2]),1==e&&0==o?(i.find(".countdown-number-hour").html("00"),i.find(".countdown-number-minute").html("00"),i.find(".countdown-number-second").html("00"),clearInterval(u)):void 0},1e3)}(n.getStartTime,n.getEndTime,o):s(1)}(n,r.find(".geshop-coupon-style4")),function(r,c){var n={lang:GESHOP_LANG||"en",couponid:c.id,pipeline:"undefined"!=typeof GESHOP_PIPELINE?GESHOP_PIPELINE:"",platform:GESHOP_PLATFORM};r.on("click",'[data-event="getCoupon"]',function(){$.ajax({url:GESHOP_INTERFACE.getcoupon.url,data:{content:JSON.stringify(n)},dataType:"jsonp",jsonp:"callback",success:function(n){if(0===n.code){!function(n){var e=$("#js_gs_coupon_dialog_template_"+n.componentID).html(),t=$("#js_gs_coupon_dialog_view_"+n.componentID),o=JSON.parse(JSON.stringify(n));o.sign=1==o.type?o.offerAmount+"%":'<span class="js-currency" data-currency="price">$price</span>'.replace("price",o.offerAmount).replace("price",o.offerAmount);var r=gs_laytpl(e).render(o);t.html(r),window.GLOBAL&&window.GLOBAL.currency&&window.GLOBAL.currency.change_html(),window.FUN&&window.FUN.currency&&window.FUN.currency.change_html(),t.find(".gc4d1-close").click(function(){var n=$(this).attr("data-id");$("#js_gs_coupon_dialog_view_"+n).html("")})}({componentID:a,offerAmount:c.offerAmount,type:c.type,coupon_url:n.data.couponurl});var e=r.find(".geshop-coupon-style4");e.addClass("is-get"),e.find(".gc4-coupon-code").html(n.data.coupon_code),e.find(".gc4-get-message a").attr("href",n.data.couponurl);var t="";0==c.resource&&(t=1===c.type?u(i):n.data.site_url),1==c.resource&&(t=c.category_url),2==c.resource&&(t=c.product_link),e.find('.gc4-get-btn[data-type="canUse"]').attr("data-url",t)}else if(1===n.code){var o="app"===GESHOP_PLATFORM?"webAction://checkUserInfo?callback=appUserInfo()&isAlert=1":n.data.loginurl;GEShopSiteCommon.webLoginAction(o)}else 5===n.code?function(n){var e=$("#js_gs_coupon_dialog2_template_"+n).html(),t=$("#js_gs_coupon_dialog2_view_"+n),o=gs_laytpl(e).render({});t.html(o),t.find("button").click(function(){t.html("")})}(a):GEShopSiteCommon.dialog.message(n.message)}})}),r.on("click",'[data-event="useCoupon"]',function(){var n=$(this).attr("data-url");n&&(window.location.href=n)})}(r,n),function(n,e){var t=n.find(".geshop-js-circle"),o=-135,r=-135;if(e<50){o+=e/50*180}else{o=45,r+=(e-50)/50*180}t.find(".rightcircle").css("transform","rotate("+o+"deg)"),t.find(".leftcircle").css("transform","rotate("+r+"deg)")}(r,n.percent)}(n)}$LAB.script(n+"/resources/javascripts/library/gs_laytpl.js?2018100101").wait(function(){gs_laytpl.config({open:"<%",close:"%>"}),$(".geshop-U000087-coupon6").each(function(n,e){var t=$(e),o=t.attr("data-id"),r=t.attr("data-coupon-id")||0;r?(c.push(r),s.push({componentID:o,coupon_id:r})):a.push(o)}),a&&a.map(function(n){t({default:!0,componentID:n,offerAmount:10,type:1,resource:0,leftCount:100,maxCount:100})});var n={lang:GESHOP_LANG||"en",couponid:c.join(","),pipeline:"undefined"!=typeof GESHOP_PIPELINE?GESHOP_PIPELINE:"",platform:GESHOP_PLATFORM};$.ajax({url:GESHOP_INTERFACE.couponlist.url,data:{content:JSON.stringify(n)},dataType:"jsonp",jsonpCallback:"geshop_callback_087_coupon6_list",success:function(n){n.data&&n.data.couponInfo&&n.data.couponInfo.map(function(n,e){t(n,e)})}})})});