<style>
.layui-form-select .layui-edge{
	right:20px;
}
</style>

{% set buyBorderSArr = [
	{name:'无',value:'none'},
	{name:'实线',value:'solid'},
	{name:'虚线',value:'dashed'},
	{name:'点状',value:'dotted'},
	{name:'双线',value:'double'},
	{name:'继承上级',value:'inherit'},
]%}

{% set fontFamily = [
	{name:'OpenSans-Semibold (zaful)',value:'OpenSans-Semibold'},
  {name:'OpenSans-Bold (zaful)',value:'OpenSans-Bold'},
  {name:'OpenSans-Regular (zaful)',value:'OpenSans-Regular'},
  {name:'Trebuchet MS (RG)',value:'Trebuchet MS'},
  {name:'Tahoma (RW)',value:'Tahoma'},
  {name:'Arial (RW)',value:'Arial'},
  {name:'Helvetica (RW)',value:'Helvetica'},
  {name:'sans-serif (RW)',value:'sans-serif'},
  {name:'AvenirLTStd_Book (RW)',value:'AvenirLTStd_Book'},
  {name:'Georgia (RW)',value:'Georgia'},
  {name:'Times New Roman (RW)',value:'Times New Roman'},
  {name:'Verdana (RW)',value:'Verdana'},
]%}

{% set siteCodeOp = {
	baseWidthDefault: siteCode == 'zf-pc'?1260:1200,

}%}

{%
	set pageData = {
				price_ft_weight:data.price_ft_weight|default(1),
			base_bg_shadow:data.base_bg_shadow|default(0),
		vm_btn_height:data.vm_btn_height|default(100),
		vm_btn_marginBot:data.vm_btn_marginBot|default(32),
		vm_btn_text:data.vm_btn_text|default('View More'),
		vm_btn_href:data.vm_btn_href|default(''),
		vm_btn_ftc:data.vm_btn_ftc|default('#ff7e00'),
		vm_btn_fts:data.vm_btn_fts|default('20'),
		vm_btn_align:data.vm_btn_align|default('right'),
		vm_btn_ftw:data.vm_btn_ftw|default('1'),
	}
%}

<style>
.gs-lable-block{
	margin:0 0 5px 20px;
}
.gs-lable-block+.layui-input-block,.class-manage{
	margin-left:20px
}
</style>
{{include ('@app/files/parts/temp/goods_manager.twig')}}

<div class='design-form design-form-component design-form-visible'>
  <h3 class='component-form-title'>ViewMore按钮 配置
    <a href="javascript:;" class="design-form-close js_closeDesignForm gb-icon-close">
      <i class="el-icon-close"></i>
    </a>
  </h3>
  <blockquote class="component-form-quote">切换模板后，无蓝色标识的配置数据将被重置</blockquote>
  <div class="component-form-setting-item component-form-configure-item activity-component-from-item">
		<div class="layui-tab">
			<ul class="layui-tab-title">
				<li class="layui-this">模板选择</li>
				<li>样式设置</li>
			</ul>
			<div class="layui-tab-content layui-tab-content-parent" data-goodsType="">
				<div class="layui-tab-item layui-show">
						<style> {{ include('@app/htdocs/resources/stylesheets/form-less-module/theme.css') }} </style>
						{{ include ('@app/files/parts/formTemplate/components/theme.twig') }}
				</div>
				<div class="layui-tab-item">
					<div class="layui-carousel" id="form_carousel">
						<div carousel-item>
							<div>
								<fieldset class="layui-elem-field">
									<legend>常用配置</legend>
									{# 组件背景图 #}
									<div class="layui-form-item class-bg-group">
										<label class="gs-lable-block">组件背景图片</label>
										<div class="layui-input-block">
											<a href="javascript:;" class="js_openResource design-open-resource"><i class="layui-icon">&#xe64a;</i></a>
											<input class="layui-input component_bg" type="text" name="base_box_bgImage" value="{{data.base_box_bgImage}}">
											<input type="hidden" name="component_bg_value" value="{{ data.component_bg_value }}">
											<input type="hidden" name="component_bg_repeat" value="{{ data.component_bg_repeat }}">
											<input type="hidden" name="component_bg_position" value="{{ data.component_bg_position }}">
											<span class="el-button el-button--primary el-button--small el-button--blue class-background"  style="float:right">设置</span>
										</div>
									</div>
									<div class="layui-field-box">
										<div class="layui-form-item">
											<label class="gs-lable-block">组件高度</label>
											<div class="layui-input-block">
												<input type="text" name="vm_btn_height" autocomplete="off" class="layui-input" value="{{ pageData.vm_btn_height }}">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="gs-lable-block">组件下边距</label>
											<div class="layui-input-block">
												<input type="text" name="vm_btn_marginBot" autocomplete="off" class="layui-input" value="{{ pageData.vm_btn_marginBot }}">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="gs-lable-block">文案</label>
											<div class="layui-input-block">
												<input type="text" name="vm_btn_text" autocomplete="off" class="layui-input" value="{{ pageData.vm_btn_text }}">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="gs-lable-block">文字链接</label>
											<div class="layui-input-block">
												<input type="text" name="vm_btn_href" autocomplete="off" class="layui-input" value="{{ pageData.vm_btn_href }}">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="gs-lable-block">文字颜色</label>
											<div class="layui-input-block">
													<div class="color-picker-selector" data-hidden-name="vm_btn_ftc">
														<div style="background-color: {{ pageData.vm_btn_ftc }};"></div>
													</div>
													<input type="text" class="layui-input" name="vm_btn_ftc" autocomplete="off" value="{{ pageData.vm_btn_ftc }}">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="gs-lable-block">文字大小(PX)</label>
											<div class="layui-input-block">
												<input class="layui-input" type="text" name="vm_btn_fts" value="{{pageData.vm_btn_fts}}">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="gs-lable-block">文字排版</label>
											<div class="layui-input-block">
												<input type="radio" name="vm_btn_align" data-public-tag="true" value="left" title="居左" {% if pageData.vm_btn_align == 'left' or pageData.vm_btn_align is empty %} checked="checked" {% endif %}>
												<input type="radio" name="vm_btn_align" data-public-tag="true" value="center" title="居中" {% if pageData.vm_btn_align == 'center' %} checked="checked" {% endif %}>
												<input type="radio" name="vm_btn_align" data-public-tag="true" value="right" title="居右" {% if pageData.vm_btn_align == 'right' %} checked="checked" {% endif %}>
											</div>
										</div>
										<div class="layui-form-item">
											<label class="gs-lable-block">文字加粗</label>
											<div class="layui-input-block">
												<input type="radio" name="vm_btn_ftw" data-public-tag="true" value="1" title="加粗" {% if data.vm_btn_ftw == '1' or data.vm_btn_ftw is empty %} checked="checked" {% endif %}>
												<input type="radio" name="vm_btn_ftw" data-public-tag="true" value="0" title="不加粗" {% if data.vm_btn_ftw == '0' %} checked="checked" {% endif %}>
											</div>
										</div>
									</div>
								</fieldset>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
  </div>
</div>

<div class="layui-form-item geshop-form-operation">
	<button type="button" class="layui-btn layui-btn-primary js_closeDesignForm">取消</button>
		<span type="button" class="layui-btn layui-btn-normal" id="gs_submit">提交</span>
	<button type="button" class="layui-btn layui-btn-normal js_submitDesignForm layui-hide">提交</button>
</div>

<style>
	.class-add{
		display:none;
	}
	.goods-tab-lists .goods-tab-item:last-child .class-add{
		display:inline-block;
	}
</style>

<script>

	$('#gs_submit').on('click',function(){
		var goodsArr = [];
		var goodsObj = {};
		$('.goods-form-table input[name=goodSKU]').each(function(index,element){
			var $val = $(this).val();
			var $goodsImg = $(this).parents('.goods-tab-item:eq(0)').find('.tab-item-img').val();
			if($val){
				goodsArr.push({
					"goodsImg":$goodsImg,
					"goodsSKU":$val,
				});
				goodsObj[$val] = $goodsImg;
			}


		});
		if(goodsArr.length>0){
			var arr = goodsArr.map(function(item) {
				return item.goodsSKU
			});
			$('.goods-form-table input[name=goodsSKU]').val(JSON.stringify(arr.join()));
			$('.goods-form-table input[name=goodsImgSKU]').val(JSON.stringify(goodsArr));
			$('.goods-form-table input[name=goodsImgObj]').val(JSON.stringify(goodsObj));
		}else{
			$('.goods-form-table input[name=goodsSKU]').val("");
			$('.goods-form-table input[name=goodsImgSKU]').val("");
			$('.goods-form-table input[name=goodsImgObj]').val("");
		}
		/* */$(this).next('button').trigger('click');
	});

	$(function() {
		var $goodsTable = $('.goods-form-table');

		function addOne(){
			var clone = $('.tab-template',$goodsTable).clone();
			clone.removeClass('tab-template layui-hide');
			$('.goods-tab-lists',$goodsTable).append(clone);
		}
		
		function initItemIndex(){
			$('.goods-tab-lists').find('.goods-tab-item').each(function(index){
				var $this = $(this);
				var listNum = index + 1;
				$this.find('.gs-tab-index').text(listNum);
				$this.find('.tab-item-img').attr('name','tabImg'+listNum+'');
			})
		}

		/*删除分类 */
		$("#component_form1").on('click','.goods-form-table .class-close',function(){
			var $this = $('this');
			$tr = $(this).parents('.goods-tab-item:eq(0)'),
			layer.confirm('是否删除该分类?',{icon:3,title:'提示'},function(index){
				$tr.remove();
				initItemIndex();
				layer.close(index);
			});
		});

		/* 新增分类 */
		$("#component_form1").on('click','.goods-tab-lists .class-add',function(e){
			e.stopPropagation();
			addOne();
			initItemIndex();
		});

		/*移动分类 */
		$("#component_form1").on('click','.goods-form-table .class-down',function(e){
			var $this = $('this'),
			$tr = $(this).parents('.goods-tab-item:eq(0)'),
			$trNext = $tr.next();
			if(0 != $trNext.length){
				$trNext.after($tr);
			}
			initItemIndex();

		});
		$("#component_form1").on('click','.goods-form-table .class-up',function(e){
			var $this = $('this'),
			$tr = $(this).parents('.goods-tab-item:eq(0)'),
			$trPrev = $tr.prev();
			if(0 != $trPrev.length){
				$trPrev.before($tr);
			}
			initItemIndex();
		});
		
	})
</script>
