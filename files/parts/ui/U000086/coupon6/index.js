"use strict";$(function(){var a=[],u=[],c=[],n=$("[data-static-domain]:eq(0)").attr("data-static-domain")?$("[data-static-domain]:eq(0)").attr("data-static-domain"):"";function e(n,t){for(var a=n.componentID,e=0;e<=u.length;e++)e==t&&(a=u[e].componentID);n.id;var o=$("#js_gs_coupon_template_"+a).html(),r=$("#js_gs_coupon_view_"+a),c=$('[data-id="'+a+'"]').attr("data-percent-link");function i(n,t){return 1==n?t+"%":'<span class="js-currency" data-currency="price">$price</span>'.replace("price",t).replace("price",t)}!function(n){if(n.category='<a href="'+n.category_url+'">'+n.category+"</a>",n.percent=function(n,t){return n<=-1?0:0==t?100:t<n?100:parseInt(n/t*100)}(n.leftCount,n.maxCount),n.validDays=function(n,t){return(t-n)/86400}(n.enableStartTime,n.enableEndTime),n.offerAmountString=i(n.type,n.offerAmount),n.thresholdAmountString=i(2,n.thresholdAmount),1<=n.receivedCount){var t="";0==n.resource&&(t=1==n.type?c:n.site_url),1==n.resource&&(t=n.category_url),2==n.resource&&(t=n.product_link),n.use_link=t}var e=gs_laytpl(o).render(n);r.html(e),window.GLOBAL&&window.GLOBAL.currency&&window.GLOBAL.currency.change_html(),window.FUN&&window.FUN.currency&&window.FUN.currency.change_html(),function(n,o){function d(n){for(var t=["is-countReady","is-countStart","is-countEnd"],e=0;e<t.length;e++)e===n?o.addClass(t[e]):o.removeClass(t[e])}1==n.limited?function(a,c,i){var u=setInterval(function(){var n=(new Date).getTime()/1e3,t=n<parseInt(a)?0:n<parseInt(c)?1:2;d(t);var e=0==t?parseInt(a):parseInt(c);if(!(t<2))return i.find(".countdown-number-hour").html("00"),i.find(".countdown-number-minute").html("00"),i.find(".countdown-number-second").html("00"),clearInterval(u);var o=e-n,r=function(n){var t=parseInt(n),e=0,o=0;60<t&&(e=parseInt(t/60),t=parseInt(t%60),60<e&&(o=parseInt(e/60),e=parseInt(e%60)));o<10&&(o="0"+o);e<10&&(e="0"+e);t<10&&(t="0"+t);return[o,e,t]}(o);return i.find(".countdown-number-hour").html(r[0]),i.find(".countdown-number-minute").html(r[1]),i.find(".countdown-number-second").html(r[2]),1==t&&0==o?(i.find(".countdown-number-hour").html("00"),i.find(".countdown-number-minute").html("00"),i.find(".countdown-number-second").html("00"),clearInterval(u)):void 0},1e3)}(n.getStartTime,n.getEndTime,o):d(1)}(n,r.find(".geshop-coupon-style4")),function(o,r){var n={lang:GESHOP_LANG||"en",couponid:r.id,pipeline:"undefined"!=typeof GESHOP_PIPELINE?GESHOP_PIPELINE:""};o.on("click",'[data-event="getCoupon"]',function(){$.ajax({url:GESHOP_INTERFACE.getcoupon.url,data:{content:JSON.stringify(n)},dataType:"jsonp",jsonp:"callback",success:function(n){if(0===n.code){!function(n){var t=$("#js_gs_coupon_dialog_template_"+n.componentID).html(),e=$("#js_gs_coupon_dialog_view_"+n.componentID),o=JSON.parse(JSON.stringify(n));o.sign=1==o.type?o.offerAmount+"%":'<span class="js-currency" data-currency="price">$price</span>'.replace("price",o.offerAmount).replace("price",o.offerAmount);var r=gs_laytpl(t).render(o);e.html(r),window.GLOBAL&&window.GLOBAL.currency&&window.GLOBAL.currency.change_html(),window.FUN&&window.FUN.currency&&window.FUN.currency.change_html(),e.find(".gc4d1-close").click(function(){var n=$(this).attr("data-id");$("#js_gs_coupon_dialog_view_"+n).html("")})}({componentID:a,offerAmount:r.offerAmount,type:r.type,coupon_url:n.data.couponurl});var t=o.find(".geshop-coupon-style4");t.addClass("is-get"),t.find(".gc4-coupon-code").html(n.data.coupon_code),t.find(".gc4-get-message a").attr("href",n.data.couponurl);var e="";0==r.resource&&(e=1==r.type?c:n.data.site_url),1==r.resource&&(e=r.category_url),2==r.resource&&(e=r.product_link),t.find('.gc4-get-btn[data-type="canUse"]').attr("data-url",e)}else 1===n.code?window.location.href=n.data.loginurl+window.location.href:5==n.code?function(n){var t=$("#js_gs_coupon_dialog2_template_"+n).html(),e=$("#js_gs_coupon_dialog2_view_"+n),o=gs_laytpl(t).render({});e.html(o),e.find("button").click(function(){e.html("")})}(a):GEShopSiteCommon.dialog.message(n.message)}})}),o.on("click",'[data-event="useCoupon"]',function(){var n=$(this).attr("data-url");n&&(window.location.href=n)})}(r,n),function(n,t){var e=n.find(".geshop-js-circle"),o=-135,r=-135;if(t<50){o+=t/50*180}else{o=45,r+=(t-50)/50*180}e.find(".rightcircle").css("transform","rotate("+o+"deg)"),e.find(".leftcircle").css("transform","rotate("+r+"deg)")}(r,n.percent)}(n)}$LAB.script(n+"/resources/javascripts/library/gs_laytpl.js?2018100101").wait(function(){gs_laytpl.config({open:"<%",close:"%>"}),$('div[data-key="U000086"]').each(function(n,t){var e=$(t),o=e.attr("data-id"),r=e.attr("data-coupon-id")||0;r?(a.push(r),u.push({componentID:o,coupon_id:r})):c.push(o)});var n={lang:GESHOP_LANG||"en",couponid:a.join(","),pipeline:"undefined"!=typeof GESHOP_PIPELINE?GESHOP_PIPELINE:""};$.ajax({url:GESHOP_INTERFACE.couponlist.url,data:{content:JSON.stringify(n)},dataType:"jsonp",jsonpCallback:"geshop_callback_086_coupon6_list",success:function(n){try{n.data.couponInfo&&n.data.couponInfo.map(function(n,t){e(n,t)})}catch(n){console.log(n)}}}),c&&c.map(function(n){e({default:!0,componentID:n,offerAmount:10,type:1,coupon_code:"ADBVFDFFF",resource:0,leftCount:100,maxCount:100})})})});