"use strict";$(function(){$.extend($.fn,{U0000861:function(){function t(t){return i.attr((t||"").toLowerCase())||""}function o(t){return t<10?"0"+t:t}function n(t){this.status=0,this.$node=t,this.$timeLine=this.$node.find(".time-line"),this.timer=null,this.diffTime=d,this.receivedCount=0,this.getCouponDetail(),this.countDownFlag=1===parseInt(p),this.bindEvent(),this.isClick=!1,this.current_coupon_id="",m||this.goEdit()}var s=this,i=s.find(".hide-info-input"),e=t("startIn"),u=t("endIn"),h=t("startText"),r=t("getCouponText"),c=t("lang"),a=t("serverTime"),d=parseInt(a)-(new Date).getTime(),f=(t("staticDomain"),GESHOP_SITECODE?GESHOP_SITECODE.split("-")[0]:""),m=t("couponId"),p=t("countDown"),l=t("successText"),g="1"===t("env");$.extend(n.prototype,{removeCountDownBox:function(){this.$node.find(".coupon-bottom").remove()},judge:function(t){this.current_coupon_id=t.couponInfo.id,this.receivedCount=t.couponInfo.receivedCount,"rg"==f&&(this.startTime=1e3*parseInt(t.couponInfo.getStartTime),this.endTime=1e3*parseInt(t.couponInfo.getEndTime));var n=this.getCurTime();if(!this.endTime)return this.processing(),this.countDownFlag=!1,this.removeCountDownBox();this.countDownFlag||this.removeCountDownBox(),n>=this.endTime?this.end():(n<this.startTime?this.notBegin():this.processing(),this.run())},bindEvent:function(){if(!g){var n=this;this.$node.on("click",function(){if(n.status,2===n.status){if(n.isClick)return;n.isClick=!0,function(t){t=t||{},$.ajax($.extend({dataType:"jsonp",jsonp:"callback"},t))}({url:GESHOP_INTERFACE.getcoupon.url,data:{content:JSON.stringify({lang:c,couponid:n.current_coupon_id,pipeline:"undefined"!=typeof GESHOP_PIPELINE?GESHOP_PIPELINE:""})},success:function(t){n.isClick=!1,0===t.code?GEShopSiteCommon.dialog.message(l):1===t.code?window.location.href=t.data.loginurl+window.location.href:GEShopSiteCommon.dialog.message(t.message)},error:function(){n.isClick=!1}})}n.status})}},getCouponDetail:function(){if(m){var n=this,t=GESHOP_INTERFACE.couponlist.url,i={lang:c,couponid:m.replace(/,/g,"|"),pipeline:"undefined"!=typeof GESHOP_PIPELINE?GESHOP_PIPELINE:""},e=s.attr("data-id");window.GEShopCommonFn_Vue.$jsonp(t,i,{pid:e}).done(function(t){0===t.code&&(t.data.couponInfo=t.data.couponInfo[0]||{},n.judge(t.data))})}},getTime:function(){return(new Date).getTime()},getCurTime:function(){return this.getTime()},notBegin:function(){1!==this.status&&(this.status=1,this.$node.find(".coupon-text").html(e),this.$node.find(".coupon-btn").html(h));var t=parseInt(this.getCurTime()/1e3-this.startTime/1e3);0<=t?this.processing():this.runCountDown(Math.abs(t))},processing:function(){2!==this.status&&(this.status=2,this.$node.find(".coupon-text").html(u),this.$node.find(".coupon-btn").html(r));var t=parseInt(this.endTime/1e3-this.getCurTime()/1e3);t<=0?this.end():this.runCountDown(t)},end:function(){this.status=3,this.clearTimer(),this.$node.find(".coupon-text").html(u),this.$node.find(".coupon-btn").html(r),this.$node.find(".over-box").show(),this.setCountDown(0,0,0,0)},setCountDown:function(t,n,i,e){this.countDownFlag&&(this.$timeLine.eq(0).html(o(t)),this.$timeLine.eq(1).html(o(n)),this.$timeLine.eq(2).html(o(i)),this.$timeLine.eq(3).html(o(e)))},runCountDown:function(t){return t*=1e3,this.setCountDown(Math.floor(t/1e3/60/60/24),Math.floor(t/1e3/60/60%24),Math.floor(t/1e3/60%60),Math.floor(t/1e3%60))},run:function(){var t=this;this.timer=setInterval(function(){t.runTime()},1e3)},runTime:function(){1===this.status&&this.notBegin(),2===this.status&&this.processing(),3===this.status&&this.end()},clearTimer:function(){clearInterval(this.timer)},goEdit:function(){this.$node.find(".coupon-text").html(u),this.$node.find(".coupon-btn").html(r),this.setCountDown(0,0,0,0),"1"!==p&&this.removeCountDownBox()}}),new n(s)}}),$(".wrap-U000086-1").each(function(t,n){$(n).U0000861()})});