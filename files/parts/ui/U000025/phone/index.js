"use strict";$(function(){var $root=$(".geshop-U000025-phone"),$dialog=$root.find(".dialog-btn"),$js_verifycode=$rootPhone.find(".js_verifycode"),$js_contry=$rootPhone.find(".js_country"),$js_phone=$rootPhone.find(".js_phone"),$js_areaCode=$rootPhone.find(".js_areaCode"),$js_selectCountry=$rootPhone.find(".js_selectCountry");function scrollFn(){var o=$root.find(".gs-bg-img").width();document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&(1900<=o&&o<=1920&&1920<=window.innerWidth?$root.addClass("overflow"):$root.removeClass("overflow"))}$dialog.on("click",function(){$rootPhone.find(".js_country_error").text("").hide(),$rootPhone.find(".js_phone_error").text("").hide(),$rootPhone.find(".js_code_error").text("").hide(),$rootPhone.find(".js_showCode").show(),$rootPhone.find(".js_sendMes").hide(),$rootPhone.find(".js_oper").hide(),$js_areaCode.html("+86"),$js_selectCountry.data("cid",""),$js_selectCountry.html($js_selectCountry.attr("data-lang")),$js_verifycode.hide(),$js_verifycode.find("input.code-input").val(""),$js_phone.val(""),$js_contry.hasClass("active")&&$js_contry.removeClass("active"),$rootPhone.find(".geshop-U000025-dialog-phone").show()}),$root.on("click",".js-close-dialog",function(){$rootPhone.find(".geshop-U000025-dialog-phone").hide()}),scrollFn(),$(window).on("resize",scrollFn);var countryNumber={41:"1",11:"61",13:"1",40:"44",251:"971",21:"91",283:"63",36:"66",25:"60"},countryWar={countryArr:countryNumber,$country:$("#js_contry"),$sendAnother:$rootPhone.find(".js_sendAnother"),$countryList:$rootPhone.find(".country-list"),$js_areaCode:$rootPhone.find(".js_areaCode"),$selCountry:$rootPhone.find(".js_selectCountry"),$js_verifycode:$rootPhone.find(".js_verifycode"),$js_showCode:$(".js_showCode"),$js_sendMes:$(".js_sendMes"),successDom:$(".js_successBox"),infoBoxDom:$rootPhone.find(".js_infoBox"),phoneInput:$rootPhone.find(".js_phone"),sendPhone:function(o,e,n,t){var s=this,r={phone:o,code:e,cid:n},i=$root.attr("data-id");$.ajax({url:GESHOP_INTERFACE.activity_sendsms.url,type:"POST",dataType:"jsonp",jsonpCallback:"geshop_callback_"+i,data:r,success:function(o){0==o.code?"function"==typeof t&&t():(GLOBAL.PopObj.alert({msg:o.message}),s.freshVerifyCode($(".img-verifycode")))}})},checkInfo:function(o,e){$(".form .error").hide();var n=$.trim(this.phoneInput.val()),t=$rootPhone.find(".js_oper").val()+n,s=this.$selCountry.data("cid"),r=$.trim($rootPhone.find(".code-input").val()),i=$rootPhone.find(".js_tel_min").val(),h=$rootPhone.find(".js_tel_max").val();s?""==n?($(".js_phone_error").text(jsLg.formMsg.tel_msg),$(".js_phone_error").show(),this.phoneInput.focus()):/^[0-9]{1,}$/.test(n)?n.length<i?($(".js_phone_error").text(jsLg.formMsg.tel_minlength_msg.replace("{0}",i)),$(".js_phone_error").show(),this.phoneInput.focus()):n.length>h?($(".js_phone_error").text(jsLg.formMsg.tel_maxlength_msg.replace("{0}",h)),$(".js_phone_error").show(),this.phoneInput.focus()):(this.$js_verifycode.slideDown(),$(".js_showCode").hide(),$(".js_sendMes").show()):($(".js_phone_error").text(jsLg.formMsg.digits),$(".js_phone_error").show(),this.phoneInput.focus()):($(".js_country_error").text(jsLg.formMsg.country_msg),$(".js_country_error").show(),this.phoneInput.focus()),2==e&&(r?this.sendPhone(t,r,s,function(){$.layer({shade:[.5,"#000",!0],offset:["30%",""],area:["auto","auto"],title:jsLg.message,border:[1,1,"#ddd",!0],dialog:{msg:GESHOP_LANGUAGES.send_success,btns:1,type:1,btn:[jsLg.ok],yes:function(o){layer.close(o),$root.find(".geshop-U000025-dialog-phone").hide()},close:function(o){layer.close(o)}}})}):($(".js_code_error").text(jsLg.formMsg.please_enter_verification_code),$(".js_code_error").show()))},freshVerifyCode:function(o){var e=(new Date).getTime(),n=GESHOP_INTERFACE.base_verify.url;o.attr("src",n+"&"+e)},bindEvent:function bindEvent(){var self=this,_date=(new Date).getTime();$(".img-verifycode").attr("src",GESHOP_INTERFACE.base_verify.url+"&"+_date),$rootPhone.on("click",".js_country",function(){$(this).toggleClass("active")}),$rootPhone.find(".country-list").on("click","p",function(){var cid=$(this).data("cid"),cName=$(this).html();self.$selCountry.html(cName).data("cid",cid),self.$js_areaCode.html("+"+self.countryArr[cid]);var country=$(this).data("cid"),json=$("#supplier_number_json").val();json=eval("("+json+")"),$.each(json,function(o,e){var n=e.country_id;if(country==n){var t=e.supplier_number;if(""!=t){t=t.split(",");var s=e.scut_number_length;$rootPhone.find(".js_oper").show().html("");var r="";return $(t).each(function(o,e){r+='<option value="'+e+'">'+e+"</option>"}),$rootPhone.find(".js_oper").html(r),$rootPhone.find(".js_tel_min").val(s),$rootPhone.find(".js_tel_min").val(s),!1}$("#js_oper").hide().html('<option value=""></option>');s=e.number;return $("#js_tel_min").val(s),$("#js_tel_max").val(s),!1}$rootPhone.find(".js_oper").hide().html('<option value=""></option>'),$rootPhone.find(".js_tel_min").val("6"),$rootPhone.find(".js_tel_max").val("20")})}),$("body").on("click",".js_sendMes",function(){self.checkInfo($(this),"2")}),this.$js_showCode.on("click",function(){self.checkInfo($(this),"1")}),this.$sendAnother.on("click",function(){self.successDom.hide(),self.infoBoxDom.show()}),$(".img-verifycode").on("click",function(){self.freshVerifyCode($(this))})},init:function(){this.bindEvent()}};countryWar.init()});