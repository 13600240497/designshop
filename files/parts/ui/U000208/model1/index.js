"use strict";$(function(){var i=function(i,n,s){var e;return n=n||0,function(){e&&(clearTimeout(e),e=null);var t=Array.prototype.slice.call(arguments);e=setTimeout(function(){i.apply(s.context,t.concat(s))},n)}},n=function(n,s,e){s=s||0;var a,o=0;return function(){var t=(new Date).getTime(),i=Array.prototype.slice.call(arguments);o+s<=t?(n.apply(e.context,i.concat(e)),o=t):(a&&(clearTimeout(a),a=null),a=setTimeout(function(){n.apply(e.context,i.concat(e))},s))}};function e(t){this.$el=t,this.EVENT_SUBFIX=this.$el.data("key")+"_"+this.$el.data("id");var i=this.$el.find(".rank-nav-inner");this.$nav=0<i.length?i:null,this.$goodContainer=this.$el.find(".goods-section"),this.navFixed="y"===this.$el.data("isFixed"),this.isEdit=this.$el.hasClass("is-edit"),this.goods=this.$el.data("goods"),this.topGoodsTpl=gs_laytpl(this.$el.find(".rank-top-goods-tpl").html()),this.otherGoodsTpl=gs_laytpl(this.$el.find(".rank-other-goods-tpl").html()),this.isNeedArrow()?this.showArrow():this.hideArrow(),this.isEdit||this.initSwiper();var n="";if(this.$nav){var s=this.$nav.find(".rank-nav-item").eq(0).data("index");n=this.goods[s-1]?this.goods[s-1].lists:""}else n=this.goods[0].lists;this.fetchGoods(n),this.isEdit||this.addEvents()}e.prototype={constructor:e,scrollFn:function(){var t=this;if(t.$nav){var i=$(window).scrollTop(),n=t.$nav.parent().offset().top,s=n+t.$goodContainer.outerHeight();n<i&&i<s?(t.$nav.addClass("is-fixed"),t.$nav.parents(".geshop-component-box").addClass("js-geshop-nav-fixed"),$(".js_header").length&&$(".js_header").hide(),$('div[data-key="U000186"]').length&&$('div[data-key="U000186"]').find("nav").hide()):(t.$nav.removeClass("is-fixed"),t.$nav.parents(".geshop-component-box").removeClass("js-geshop-nav-fixed"),$(".js_header").length&&$(".js_header").show(),$('div[data-key="U000186"]').length&&$('div[data-key="U000186"]').find("nav").show(),GEShopSiteCommon&&GEShopSiteCommon.jsNavFixed())}},resizeFn:function(){var t=this;t.$nav&&(t.isNeedArrow()?t.showArrow():t.hideArrow(),t.activeNav(t.$nav.find(".active")))},activeNav:function(t){if(t.addClass("active").siblings(".rank-nav-item").removeClass("active"),this.swiper){var i=this.$nav.find(".rank-nav").width(),n=i/2,s=this.$nav.find(".rank-nav-content").width(),e=n,a=s-n,o=t.outerWidth(),r=t.position().left+o/2;i<s&&(r<=e?this.swiper.setWrapperTranslate(0):e<r&&r<a?this.swiper.setWrapperTranslate(n-r):this.swiper.setWrapperTranslate(-s+i),this.swiper.setWrapperTransition(300))}},addEvents:function(){var s=this;this.$el.on("click."+this.EVENT_SUBFIX,".rank-nav-item",function(){var t=$(this);if(!t.hasClass("active")){var i=t.data("index"),n=s.goods[i-1].lists;s.fetchGoods(n),s.activeNav(t)}}).on("click."+this.EVENT_SUBFIX,".rank-good-promotion.has-more",function(t){s.$el.find(".rank-good-promotion.has-more").not(this).removeClass("opened"),$(this).toggleClass("opened"),$(document).one("click"+e.EVENT_SUBFIX,function(){s.$el.find(".rank-good-promotion.has-more").removeClass("opened")}),t.stopPropagation()}).on("click."+this.EVENT_SUBFIX,".rank-nav-pre",function(){s.swiper&&s.slidePrev()}).on("click."+this.EVENT_SUBFIX,".rank-nav-next",function(){s.swiper&&s.slideNext()});var t=$(window);this.$nav&&this.navFixed&&(this.scrollHandler=n(this.scrollFn,100,{context:this}),t.on("scroll."+this.EVENT_SUBFIX,this.scrollHandler)),this.resizeHandler=i(this.resizeFn,300,{context:this}),t.on("resize."+this.EVENT_SUBFIX,{context:this},this.resizeHandler)},removeEvents:function(){this.$el.off(this.EVENT_SUBFIX)},isNeedArrow:function(){if(!this.$nav)return!1;if($(window).outerWidth(!0)<768)return!1;var t=this.$nav.find(".rank-nav-content").width();return this.$nav.find(".rank-nav").width()<t},showArrow:function(){this.$nav&&(this.$nav.find(".rank-nav").addClass("has-arrow"),this.$nav.find(".rank-nav-pre, .rank-nav-next").show())},hideArrow:function(){this.$nav&&(this.$nav.find(".rank-nav").removeClass("has-arrow"),this.$nav.find(".rank-nav-pre, .rank-nav-next").hide())},slidePrev:function(){var t=this.getFirstNavItemInview();if(t){var i=t.prev(),n=Math.floor(t.position().left),s=null;if(0<i.length)s=n<-Math.floor(this.$nav.find(".rank-nav-content").position().left)+parseInt(this.$nav.find(".rank-nav").css("paddingLeft"))?n:Math.floor(i.position().left);else s=0;this.swiper.setWrapperTranslate(-s),this.swiper.setWrapperTransition(300)}},slideNext:function(){var t=this.getFirstNavItemInview();if(t){var i=t.next(),n=this.$nav.find(".rank-nav-content"),s=Math.floor(n.width()),e=this.$nav.find(".rank-nav"),a=Math.floor(e.width()),o=parseInt(e.css("paddingLeft")),r=null,h=0;h=!(0<i.length)||s-a<=(r=Math.floor(i.position().left))+o?s-a:r,this.swiper.setWrapperTranslate(-h),this.swiper.setWrapperTransition(300)}},getFirstNavItemInview:function(){var e=-Math.floor(this.$nav.find(".rank-nav-content").position().left)+parseInt(this.$nav.find(".rank-nav").css("paddingLeft")),a=null;return this.$nav.find(".rank-nav-item").each(function(){var t=$(this),i=Math.floor(t.position().left),n=Math.floor(t.width()),s=parseInt(t.css("paddingLeft"));if(e<i+n+s)return a=t,!1}),a},initSwiper:function(){if(this.$nav)try{this.swiper=new Swiper3(this.$nav.find(".rank-nav")[0],{wrapperClass:"rank-nav-content",slideClass:"rank-nav-item",slidesPerView:"auto",freeMode:!0})}catch(t){}},imageLazy:function(){this.isEdit?this.$el.find("img.js_rank_lazy").each(function(){var t=$(this);t.attr("src",t.attr("data-original"))}):$.fn.lazyload?this.$el.find("img.js_rank_lazy").lazyload({failure_limit:60}).removeClass("js_rank_lazy"):window.GS_GOODS_LAZY_FN(".js_rank_lazy")},triggerExplore:function(){$(document).triggerHandler("logsss_explore",{$elList:this.$el.find(".rank-good.js_logsss_browser")})},renderGoods:function(t){var i=this.topGoodsTpl.render(t.slice(0,3)),n=this.otherGoodsTpl.render(t.slice(3));this.$goodContainer.html(i+n)},scrollToGoods:function(){if(this.$nav&&this.$nav.hasClass("is-fixed")){var t=this,i=$(window),n=this.$goodContainer.offset().top-this.$nav.height();i.off("scroll."+this.EVENT_SUBFIX),$("html, body").stop(!0).animate({scrollTop:n},function(){i.on("scroll."+t.EVENT_SUBFIX,t.scrollHandler)})}},fetchGoods:function(t){var n=this;if(t){var i=GESHOP_INTERFACE.getrankdetail.url,s=this.$el.attr("data-id"),e={lang:GESHOP_LANG,client:GESHOP_PLATFORM,goodsSn:t};window.GEShopCommonFn_Vue.$jsonp(i,e,{pid:s}).done(function(t){if(0===t.code){var i=t.data||[];n.renderGoods(i),n.scrollToGoods(),n.imageLazy(),n.triggerExplore(),window.GLOBAL&&window.GLOBAL.currency&&window.GLOBAL.currency.change_huobi()}})}else this.isEdit||this.$goodContainer.html("")}};var t=$LAB;"classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||(t=$LAB.script(GESHOP_STATIC+"/resources/javascripts/library/classList.min.js")),t.script(GESHOP_STATIC+"/resources/javascripts/library/gs_laytpl.js").script(GESHOP_STATIC+"/resources/javascripts/library/swiper/swiper.3.4.spec.min.js").wait(function(){gs_laytpl.config({open:"<%",close:"%>"}),$(".geshop-U000208-model1").each(function(){try{new e($(this))}catch(t){}})})});